# SSOT作成ルール（汎用版）

**作成日**: 2026-02-17
**バージョン**: 1.0.0
**元**: hotel-kanri SSOT作成ルール v1.0.0 をプロダクト非依存化
**目的**: 高品質なSSOT（Single Source of Truth）を作成するための完全なガイドライン

---

## SSOTとは何か

### 定義
**SSOT（Single Source of Truth）** = **唯一の真実の情報源**

これは単なる「API仕様書」ではない。

### SSOTに含むべき全要素
1. **バックエンド実装方法**（API、DB、サーバーミドルウェア）
2. **フロントエンド実装方法**（Composable、状態管理、クライアントミドルウェア）
3. **処理フロー**（成功後の遷移、初回アクセス時の挙動）
4. **禁止事項**（やってはいけないこと）
5. **落とし穴**（SSOTに準拠しないと発生する問題）
6. **環境統一要件**（開発・本番で同じ実装）
7. **命名規則**（DB、API、ORM、変数の統一）

### SSOTの目的
- 実装者が迷わない
- 誤実装が起きない
- 問題を未然に防ぐ
- 開発・本番で同じ動作をする

---

## SSOT作成プロセス（7フェーズ）

### Phase 0: 既存SSOT読み込み + 本番同等チェック（最重要）
**目的**: SSOT間の整合性を保つ + 本番障害を防ぐ

**実行内容**:
1. プロジェクトの既存SSOT全てを読み込む
2. 本番同等ルールを確認（存在する場合）
3. 対象機能のハードコード検出

**確認項目**:
- [ ] 既存SSOTで使用されている変数名・フィールド名を把握
- [ ] 命名規則を把握（DB: snake_case, API: camelCase）
- [ ] データ型の使用パターンを把握
- [ ] 認証方式を確認
- [ ] テナント/組織IDハードコードの検出
- [ ] 環境分岐実装の検出
- [ ] モックデータ常時使用の検出

**禁止事項**:
- 既存SSOTを読まずに作成を開始すること
- 既存SSOTと異なる命名規則を使用すること
- ハードコード検出を実行せずに作成すること

---

### Phase 1: 既存ドキュメント読み込み
**目的**: プロジェクトの決定事項を把握

**確認項目**:
- [ ] 技術スタック（認証方式、DB、ORM、状態管理）
- [ ] 既存の設計決定事項
- [ ] 既知の問題・課題

**禁止事項**:
- ドキュメントを読まずに「想像」で仕様を作成すること
- 過去の設計決定を無視すること

---

### Phase 2: 実装ファイル読み込み
**目的**: 実際の実装を正確に把握

**確認項目**:
- [ ] 実際のAPIパス（想像ではなく実ファイルから）
- [ ] リクエスト・レスポンスの実データ構造
- [ ] 実装されている処理フロー
- [ ] 使用されているComposable・ミドルウェア
- [ ] エラーハンドリングの実装

**禁止事項**:
- 実装ファイルを読まずに「推測」で記載すること
- 存在しないAPIパスを記載すること
- 実装と異なるデータ構造を記載すること

---

### Phase 3: ドキュメント・実装の差異分析 + 本番同等性チェック
**目的**: 「あるべき姿」と「現状」を区別 + 本番障害を防ぐ

**実行内容**:
1. 既存ドキュメントの仕様を確認
2. 実際の実装を確認
3. 両者の差異を分析
4. 本番同等性の検証

**記載方法**:
```markdown
## 現在の実装の問題点

### Critical: [問題名]

**ファイル**: /path/to/file.ts (line XX)
**コード**: `問題のあるコード`
**症状**: 開発環境では動作するが、本番環境で問題
**原因**: 原因の説明
**対応**: 修正方法
**修正必須箇所**: /path/to/file.ts (line XX)
```

**禁止事項**:
- 「ドキュメントが正しい」と決めつけること
- 「実装が正しい」と決めつけること
- 差異を無視して記載すること

---

### Phase 3.5: 実行トレース（推奨）
**目的**: 実際の動作を100%正確に記録

**実行内容**:
1. トレースログを追加（開発環境のみ）
2. 実際に機能を実行
3. 全ログを時系列で記録
4. 変数の状態変化を追跡

**メリット**:
- 推測ではなく実測
- 変数変化の完全な可視化
- 問題の早期発見
- パフォーマンス分析

**禁止事項**:
- トレースなしで「たぶんこう動く」と推測すること

---

### Phase 4: SSOT記述（正しい仕様を定義）
**目的**: 「あるべき姿」を明確に定義

**記載内容**:
1. **正しい仕様**（あるべき姿）
2. **現在の実装の問題点**（仕様違反）
3. **修正必須箇所**（ファイルパス・行番号）

**禁止事項**:
- 「現在の実装」をそのままSSOTにすること
- 問題点を指摘せずに隠すこと

---

### Phase 5: 必須要件・問題予防を明記
**目的**: 誤実装を未然に防ぐ

**必須セクション**:

1. **必須要件（CRITICAL）** — システムが正しく動作するための絶対条件
2. **禁止事項** — やってはいけない実装パターン
3. **既知の問題（落とし穴）** — SSOTに準拠しないと発生する問題
4. **検証方法** — 正しく実装されているか確認する方法

---

### Phase 6: 既存SSOTとの整合性確認
**目的**: SSOT間の不整合を防ぐ

**確認項目**:
- [ ] 同じ概念が同じ名称で記載されているか
- [ ] 命名規則が統一されているか
- [ ] データ型が統一されているか
- [ ] 認証方式が一致しているか
- [ ] クロスリファレンスが追加されているか

**禁止事項**:
- 既存SSOTと異なる命名を使用すること
- 既存SSOTへのクロスリファレンスを省略すること

---

### Phase 7: 最終チェック
**目的**: 完璧なSSOTを保証

**チェックリスト**:

#### バックエンド仕様
- [ ] API仕様（エンドポイント、リクエスト、レスポンス、エラー）
- [ ] 実装ファイルパス（絶対パス・行番号付き）
- [ ] 認証・認可の仕様
- [ ] データベーススキーマ

#### フロントエンド仕様
- [ ] Composableの詳細仕様
- [ ] 状態管理の仕組み
- [ ] ページ遷移時の処理

#### 命名規則・整合性
- [ ] 命名規則統一セクション
- [ ] 既存SSOTとの整合性
- [ ] クロスリファレンス

#### 問題予防
- [ ] 必須要件（CRITICAL）
- [ ] 禁止事項
- [ ] 落とし穴
- [ ] 検証方法

#### 環境統一
- [ ] 開発・本番で同じ実装
- [ ] 環境変数のみで差異吸収
- [ ] 環境別実装の禁止を明記

#### 品質
- [ ] 想像・推測で書いた箇所がないか
- [ ] 全てのファイルパスが正しいか
- [ ] 実装と一致しているか

---

## 禁止事項（絶対に守る）

### Phase 0-3を飛ばすこと
- 既存SSOTを読まずに作成
- ドキュメントを読まずに作成
- 実装ファイルを読まずに作成

### 想像・推測で記載すること
- 存在しないAPIパスを記載
- 実装と異なるデータ構造を記載
- 「〜だと思われる」という表現

### 既存SSOTとの不整合
- 異なる命名規則を使用
- 同じ概念を異なる名称で記載
- クロスリファレンスを省略

### 環境別実装を許容すること
- 「開発環境だけ〜」という記載
- 環境変数以外での環境分岐

### 問題予防セクションの省略
- 必須要件を省略
- 禁止事項を省略
- 落とし穴を省略

---

## 品質保証チェックリスト

- [ ] Phase 0-6 完了
- [ ] 想像・推測ゼロ
- [ ] 命名規則統一
- [ ] クロスリファレンス追加
- [ ] 問題予防セクション完備
- [ ] 環境統一要件明記
- [ ] 実装者が迷わないレベルの詳細度

---

**バージョン**: 1.0.0
**元ファイル**: hotel-kanri/docs/03_ssot/_SSOT_CREATION_RULES.md (v1.0.0)
**汎用化**: Dev Coordinator (2026-02-17)
