# SSOT-2: UI / 状態遷移定義 [CONTRACT]

> 画面一覧・ナビゲーション構造・状態遷移・コンポーネント設計方針を管理する
> RFC 2119 準拠: MUST（必須）/ SHOULD（推奨）/ MAY（任意）

---

## 基本情報

| 項目 | 内容 |
|------|------|
| UIフレームワーク | Nuxt UI v3（Tailwind CSS 4 ベース） |
| レスポンシブ | PC + タブレット + スマートフォン |
| デザイン言語 | モダン・クリーン・プロフェッショナル |
| カラーテーマ | ライト/ダークモード対応 |
| 作成日 | 2026-02-06 |
| ステータス | Draft |

---

## §1. ロール別ナビゲーション構造 [CORE]

### 1.1 全体構成

```
┌─────────────────────────────────────────────────────┐
│  AppBar（ロゴ・テナント切替・通知・AI・プロフィール）     │
├──────────┬──────────────────────────────────────────┤
│          │                                          │
│  Sidebar │            Main Content                  │
│  (ナビ)   │                                          │
│          │                                          │
│  ・ダッシュ │                                          │
│  ・イベント │                                          │
│  ・タスク   │                                          │
│  ・会場    │                                          │
│  ・AI     │                                          │
│  ・設定    │                                          │
│          │                                          │
├──────────┴──────────────────────────────────────────┤
│  AI Assistant Panel (右サイドパネル・折りたたみ可)       │
└─────────────────────────────────────────────────────┘
```

### 1.2 ロール別メニュー表示

| メニュー | admin | organizer | venue_staff | streaming | planner | speaker | sales | participant |
|---------|-------|-----------|-------------|-----------|---------|---------|-------|-------------|
| ダッシュボード | ◎ | ◎ | ◎ | ◎ | ◎ | ◎ | ◎ | - |
| イベント一覧 | ◎ | ◎ | ◎ | ◎ | ◎ | ○ | ◎ | - |
| イベント作成 | ◎ | ◎ | - | - | ◎ | - | - | - |
| タスク一覧 | ◎ | ◎ | ◎ | ◎ | ◎ | ○ | ○ | - |
| 会場管理 | ◎ | ○ | ◎ | - | ○ | - | - | - |
| 見積り | ◎ | ◎ | - | ◎ | ◎ | - | - | - |
| 参加者管理 | ◎ | ◎ | ◎ | - | ◎ | - | ◎ | - |
| レポート | ◎ | ◎ | ○ | - | ◎ | - | ◎ | - |
| テナント設定 | ◎ | - | - | - | - | - | - | - |
| AI アシスタント | ◎ | ◎ | ◎ | ◎ | ◎ | ◎ | ◎ | - |
| 通知 | ◎ | ◎ | ◎ | ◎ | ◎ | ◎ | ◎ | - |

◎ = フルアクセス　○ = 制限付き閲覧　- = 非表示

---

## §2. 画面一覧 [CORE]

### 2.1 認証系（Public）

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| AUTH-01 | ログイン | `/login` | メール/パスワードログイン |
| AUTH-02 | 新規登録 | `/register` | アカウント作成 |
| AUTH-03 | パスワードリセット | `/forgot-password` | パスワードリセット要求 |
| AUTH-04 | パスワード再設定 | `/reset-password` | 新しいパスワード設定 |
| AUTH-05 | メール認証 | `/verify-email` | メール認証完了 |
| AUTH-06 | 招待受け入れ | `/invite/:token` | テナント招待の受け入れ |
| AUTH-07 | テナント選択 | `/select-tenant` | 複数テナント所属時の選択 |

### 2.2 ダッシュボード

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| DASH-01 | メインダッシュボード | `/dashboard` | ロール別のKPI・直近イベント・タスク |

**ダッシュボード構成:**

```
┌──────────────────────────────────────────────┐
│  Welcome, 田中さん          [テナント名]       │
├──────────┬───────────┬───────────────────────┤
│ 今月の    │ 今月の     │ 未完了タスク          │
│ イベント数 │ 参加者数   │ 12件                 │
│ 8件      │ 340名     │ うち期限超過: 2件      │
├──────────┴───────────┴───────────────────────┤
│  直近のイベント                                │
│  ┌─────────────────────────────────────────┐ │
│  │ 3/15 AI活用セミナー  [確定] 残タスク:5    │ │
│  │ 3/22 新製品発表会    [企画中] 残タスク:12  │ │
│  └─────────────────────────────────────────┘ │
├──────────────────────────────────────────────┤
│  マイタスク（期限順）                          │
│  □ 配信機材確認（AI活用セミナー）  D-7         │
│  □ 講演スライド提出依頼           D-5         │
│  ☑ 会場下見                     完了         │
└──────────────────────────────────────────────┘
```

### 2.3 イベント管理

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| EVT-01 | イベント一覧 | `/events` | 全イベントのリスト・フィルタ・検索 |
| EVT-02 | イベント作成（AIアシスト） | `/events/new` | ゴールベースAIアシスト作成 |
| EVT-03 | イベント詳細 | `/events/:id` | イベントサマリー・関係者・タスク概要 |
| EVT-04 | イベント編集 | `/events/:id/edit` | イベント情報編集 |
| EVT-05 | タスクボード | `/events/:id/tasks` | ガントチャート / カンバン表示 |
| EVT-06 | 登壇者管理 | `/events/:id/speakers` | 登壇者の管理・紹介文生成 |
| EVT-07 | 参加者管理 | `/events/:id/participants` | 参加者の一覧・登録・CSVインポート |
| EVT-08 | チェックイン | `/events/:id/checkin` | 当日のQRチェックイン画面 |
| EVT-09 | 当日タイムライン | `/events/:id/timeline` | 当日の進行管理（配信業者向け） |
| EVT-10 | アンケート管理 | `/events/:id/surveys` | アンケート作成・回答閲覧・集計 |
| EVT-11 | レポート | `/events/:id/reports` | AI生成レポート・手動レポート |

### 2.4 会場管理

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| VEN-01 | 会場一覧 | `/venues` | 会場リスト（拠点別） |
| VEN-02 | 会場詳細 | `/venues/:id` | 会場情報・機材・空き状況 |
| VEN-03 | 会場登録/編集 | `/venues/:id/edit` | 会場情報の登録・編集 |
| VEN-04 | 空き状況カレンダー | `/venues/calendar` | 全会場の空き状況カレンダー |

### 2.5 見積り

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| EST-01 | 見積り一覧 | `/estimates` | 見積りリスト |
| EST-02 | 見積り作成（AIアシスト） | `/estimates/new` | AIアシスト付き見積り作成 |
| EST-03 | 見積り詳細 | `/estimates/:id` | 見積り詳細・印刷 |

### 2.6 AI アシスタント

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| AI-01 | AIチャット | (右サイドパネル) | コンテキスト対応チャット |
| AI-02 | 会話履歴 | `/ai/history` | 過去のAI会話一覧 |

### 2.7 通知

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| NTF-01 | 通知一覧 | `/notifications` | 全通知リスト |
| NTF-02 | 通知ポップオーバー | (ヘッダベル) | 直近の通知表示 |

### 2.8 テナント設定

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| SET-01 | テナント設定 | `/settings` | テナント基本情報・プラン |
| SET-02 | メンバー管理 | `/settings/members` | メンバー一覧・招待・ロール変更 |
| SET-03 | 配信パッケージ設定 | `/settings/packages` | 配信パッケージの管理 |
| SET-04 | プロフィール設定 | `/settings/profile` | 個人設定 |

### 2.9 参加者ポータル（Public）

| ID | 画面名 | パス | 説明 |
|----|-------|------|------|
| PRT-01 | ポータルトップ | `/p/:slug` | イベント情報・概要 |
| PRT-02 | 参加登録フォーム | `/p/:slug/register` | 参加申し込み |
| PRT-03 | 登壇者紹介 | `/p/:slug/speakers` | 登壇者一覧 |
| PRT-04 | タイムテーブル | `/p/:slug/schedule` | 当日スケジュール |
| PRT-05 | 登録完了 | `/p/:slug/thanks` | 登録完了画面（QRコード） |

---

## §3. 主要な状態遷移 [CONTRACT]

### 3.1 イベントライフサイクル

```
                    ┌──────────┐
                    │  draft   │ ← 初期状態（企画中）
                    └────┬─────┘
                         │ 企画確定
                    ┌────▼─────┐
                    │ planning │ ← タスク生成・関係者招待
                    └────┬─────┘
                         │ 会場/配信確定
                    ┌────▼─────┐
                    │confirmed │ ← 確定・集客開始
                    └────┬─────┘
                         │ 準備完了チェック
                    ┌────▼─────┐
                    │  ready   │ ← 当日待ち
                    └────┬─────┘
                         │ イベント開始
                  ┌──────▼──────┐
                  │ in_progress │ ← 開催中
                  └──────┬──────┘
                         │ 終了
                   ┌─────▼─────┐
                   │ completed │ ← 終了（レポート生成可）
                   └───────────┘

  ※ どの状態からも → cancelled（キャンセル）へ遷移可能
```

**状態遷移ルール:**

| From | To | 条件 |
|------|-----|------|
| draft → planning | 必須項目入力済み（タイトル・日時・種別） |
| planning → confirmed | 会場 OR 配信URL設定済み |
| confirmed → ready | 全P0タスク完了 |
| ready → in_progress | 開始日時到達 or 手動開始 |
| in_progress → completed | 終了日時到達 or 手動終了 |
| * → cancelled | organizer の操作 |

### 3.2 タスク状態遷移

```
  ┌─────────┐
  │ pending │ ← 初期状態
  └────┬────┘
       │ 着手
  ┌────▼─────────┐
  │ in_progress  │
  └────┬─────────┘
       │
  ┌────▼─────────┐
  │  completed   │ ← 完了
  └──────────────┘

  ※ pending/in_progress → skipped（スキップ）へ遷移可能
```

### 3.3 参加者登録フロー

```
         ポータルアクセス
              │
         ┌────▼────┐
         │ 未登録  │
         └────┬────┘
              │ フォーム送信
        ┌─────▼──────┐
        │ registered │ ← 登録済み（メール送信）
        └─────┬──────┘
              │ メール確認 or 自動
        ┌─────▼──────┐
        │ confirmed  │ ← 確定（QRコード発行）
        └─────┬──────┘
              │ 当日
        ┌─────▼──────┐
        │ checked_in │ ← チェックイン完了
        └────────────┘

  ※ registered/confirmed → cancelled（キャンセル）へ遷移可能
```

### 3.4 見積り状態遷移

```
  ┌───────┐
  │ draft │ ← AI生成 or 手動作成
  └───┬───┘
      │ 送信
  ┌───▼───┐
  │  sent │ ← クライアントに送信済み
  └───┬───┘
      │ 承認
  ┌───▼──────┐
  │ approved │ ← 承認済み
  └──────────┘
```

### 3.5 登壇者資料提出状態

```
  ┌─────────┐
  │ pending │ ← 依頼中
  └────┬────┘
       │ 資料アップロード
  ┌────▼──────┐
  │ submitted │ ← 提出済み
  └────┬──────┘
       │ 確認OK
  ┌────▼──────┐
  │ confirmed │ ← 確認完了
  └───────────┘
```

---

## §4. AI アシスタント Panel 設計 [CONTRACT]

```
┌──────────────────────────────────┐
│  🤖 AI アシスタント    [−] [×]    │
├──────────────────────────────────┤
│  コンテキスト: AI活用セミナー      │
│  ────────────────────────────── │
│                                  │
│  User: 100人規模のセミナーを      │
│  企画したいです                   │
│                                  │
│  AI: 以下の企画案を作成しました。  │
│  ┌─────────────────────────┐    │
│  │ [企画書ドラフト]          │    │
│  │ ・タイトル: AI活用最前線   │    │
│  │ ・日時: 3/15 14:00-17:00 │    │
│  │ ・形式: ハイブリッド      │    │
│  │ [この内容で作成] [編集]   │    │
│  └─────────────────────────┘    │
│                                  │
├──────────────────────────────────┤
│  [メッセージを入力...] [送信 ▶]   │
│                                  │
│  クイックアクション:              │
│  [企画書作成] [見積り] [メール]    │
└──────────────────────────────────┘
```

**コンテキスト連動ルール:**

| 現在の画面 | AIに渡すコンテキスト |
|-----------|-------------------|
| ダッシュボード | テナント情報、直近イベント |
| イベント詳細 | そのイベントの全情報 |
| タスクボード | そのイベントのタスク一覧 |
| 登壇者管理 | そのイベントの登壇者情報 |
| 参加者管理 | そのイベントの参加者統計 |
| 見積り作成 | イベント情報、配信パッケージ |

---

## §3-E. 入出力例 [CONTRACT]

> UI/画面表示の主要な入出力パターン（正常系3件・異常系3件）

### E-1: ダッシュボード画面表示（正常系）

| 項目 | 値 |
|------|-----|
| 入力 | URL: /dashboard, ロール: organizer, テナント: tenant-001 |
| 出力 | ダッシュボードレイアウト（Sidebar + Main + AI Panel入口）、直近イベント一覧、通知バッジ表示 |

### E-2: ロール別サイドバー表示（正常系）

| 項目 | 値 |
|------|-----|
| 入力 | ロール: venue_staff |
| 出力 | サイドバーに会場管理・予約管理メニューのみ表示、イベント作成メニュー非表示 |

### E-3: AIチャットパネル展開（正常系）

| 項目 | 値 |
|------|-----|
| 入力 | Cmd+K / ヘッダーAI入力欄クリック |
| 出力 | 右サイドスライドオーバー（480px）が展開、チャット/履歴タブ表示 |

### E-4: 未認証アクセス（異常系）

| 項目 | 値 |
|------|-----|
| 入力 | URL: /dashboard, セッション: なし |
| 出力 | /auth/login へリダイレクト |

### E-5: 権限外ページアクセス（異常系）

| 項目 | 値 |
|------|-----|
| 入力 | URL: /admin/tenants, ロール: participant |
| 出力 | 403エラーページ表示「このページへのアクセス権限がありません」 |

### E-6: 存在しないページ（異常系）

| 項目 | 値 |
|------|-----|
| 入力 | URL: /nonexistent-page |
| 出力 | 404エラーページ表示「ページが見つかりません」 |

---

## §3-F. 境界値 [CONTRACT]

| データ項目 | 下限 | 上限 | 境界パターン |
|-----------|------|------|------------|
| ビューポート幅 | 320px（最小モバイル） | 2560px（4K） | 768px（モバイル↔タブレット）、1280px（タブレット↔デスクトップ） |
| サイドバーメニュー項目数 | 1（participant） | 15（system_admin） | ロール別に動的変化 |
| 通知バッジ数 | 0（非表示） | 99+（上限表示） | 99→「99+」切り替え |
| AI Panelスライドオーバー幅 | 480px（デスクトップ） | 100vw（モバイル） | 768px以下で全画面モーダル |
| テナント名表示文字数 | 1文字 | 20文字（切り詰め） | 21文字以上は「...」付与 |
| イベントカード一覧表示数 | 0件（Empty State） | 50件（1ページ） | 0件→EmptyStateコンポーネント |
| タブ切替数 | 2（最小：チャット/履歴） | 5（最大タブ数） | — |

---

## §3-G. 例外応答 [CONTRACT]

| エラーコード | 画面表示 | ユーザーへの案内 |
|------------|---------|---------------|
| 401_UNAUTHORIZED | /auth/login へリダイレクト | セッション切れの場合「再度ログインしてください」 |
| 403_FORBIDDEN | 403エラーページ | 「このページへのアクセス権限がありません。管理者にお問い合わせください」 |
| 404_NOT_FOUND | 404エラーページ | 「お探しのページは見つかりませんでした」+ダッシュボードへのリンク |
| 500_SERVER_ERROR | 500エラーページ | 「サーバーエラーが発生しました。しばらくしてから再度お試しください」 |
| NETWORK_ERROR | トースト通知 | 「ネットワーク接続を確認してください」+リトライボタン |
| AI_PANEL_ERROR | AIパネル内エラー表示 | 「AIの応答に問題が発生しました。再度お試しください」 |

---

## §3-H. Gherkin シナリオ [CONTRACT]

```gherkin
Scenario: ダッシュボードのロール別表示
  Given ユーザーが "organizer" ロールでログインしている
  When ダッシュボードページにアクセスする
  Then サイドバーにイベント管理メニューが表示される
  And AIアシスタント入力欄がヘッダーに表示される

Scenario: participantのポータルレイアウト
  Given ユーザーが "participant" ロールでログインしている
  When ダッシュボードページにアクセスする
  Then サイドバーは非表示になる
  And モバイルボトムタブが表示される

Scenario: AIチャットパネルのキーボードショートカット
  Given ユーザーがダッシュボードにいる
  When Cmd+K（またはCtrl+K）を押下する
  Then AIチャットパネルがスライドオーバーで展開される

Scenario: モバイルレスポンシブ表示
  Given ビューポート幅が767pxである
  When ダッシュボードページにアクセスする
  Then サイドバーは非表示（オーバーレイ形式）になる
  And モバイルボトムナビゲーションが表示される

Scenario: 未認証ユーザーのリダイレクト
  Given ユーザーがログインしていない
  When /dashboard にアクセスする
  Then /auth/login にリダイレクトされる

Scenario: ダークモード切替
  Given ユーザーがライトモードで表示している
  When ダークモードトグルをクリックする
  Then 全コンポーネントがダークテーマカラーに変更される
```

---

## §5. レスポンシブ対応方針 [DETAIL]

| ブレークポイント | 幅 | レイアウト |
|---------------|-----|----------|
| Desktop | ≥1280px | Sidebar + Main + AI Panel |
| Tablet | 768-1279px | Collapsible Sidebar + Main |
| Mobile | <768px | Bottom Nav + Full Screen |

**モバイル時の制限:**
- AI Panel は全画面モーダルに変更
- ガントチャートはリスト表示にフォールバック
- 一部管理画面は「PCでの操作を推奨」表示

---

## §6. コンポーネント設計方針 [DETAIL]

### 6.1 ディレクトリ構成

```
components/
├── ui/                  ← Nuxt UI v3 のラッパー（必要時のみ）
├── layout/
│   ├── AppBar.vue
│   ├── Sidebar.vue
│   ├── AiPanel.vue
│   └── MobileNav.vue
├── event/
│   ├── EventCard.vue
│   ├── EventForm.vue
│   ├── EventStatusBadge.vue
│   └── EventTimeline.vue
├── task/
│   ├── TaskBoard.vue      ← カンバン表示
│   ├── TaskGantt.vue      ← ガントチャート
│   ├── TaskItem.vue
│   └── TaskForm.vue
├── participant/
│   ├── ParticipantTable.vue
│   ├── CheckinScanner.vue
│   └── ImportCsv.vue
├── speaker/
│   ├── SpeakerCard.vue
│   └── SpeakerForm.vue
├── estimate/
│   ├── EstimateEditor.vue
│   └── EstimatePreview.vue
├── ai/
│   ├── AiChat.vue
│   ├── AiMessage.vue
│   ├── AiActionCard.vue
│   └── AiQuickActions.vue
├── survey/
│   ├── SurveyBuilder.vue
│   └── SurveyResult.vue
└── shared/
    ├── DataTable.vue
    ├── DateRangePicker.vue
    ├── FileUploader.vue
    ├── StatusBadge.vue
    └── EmptyState.vue
```

### 6.2 状態管理

```
composables/
├── useAuth.ts            ← Better Auth セッション管理
├── useTenant.ts          ← 現在のテナントコンテキスト
├── useEvents.ts          ← イベント CRUD + フィルタ
├── useTasks.ts           ← タスク CRUD + 状態遷移
├── useAi.ts              ← AI チャット + ストリーミング
├── useNotifications.ts   ← 通知（リアルタイム）
└── usePermission.ts      ← ロール別権限チェック
```

**状態管理方針:**
- **サーバー状態**: Nuxt `useFetch` / `useAsyncData` でサーバーから取得
- **UI状態**: Vue 3 `ref` / `reactive` + Pinia（必要時のみ）
- **フォーム状態**: VeeValidate + Zod スキーマ
- **AIストリーミング**: Vercel AI SDK `useChat`

---

## §7. テーマ・カラーパレット [DETAIL]

| 用途 | Light | Dark | 説明 |
|------|-------|------|------|
| Primary | `#2563EB` (Blue 600) | `#3B82F6` (Blue 500) | メインアクション |
| Secondary | `#7C3AED` (Violet 600) | `#8B5CF6` (Violet 500) | AI関連 |
| Success | `#059669` (Emerald 600) | `#10B981` (Emerald 500) | 完了・成功 |
| Warning | `#D97706` (Amber 600) | `#F59E0B` (Amber 500) | 注意・期限間近 |
| Danger | `#DC2626` (Red 600) | `#EF4444` (Red 500) | エラー・期限超過 |
| Background | `#FFFFFF` | `#0F172A` (Slate 900) | 背景 |
| Surface | `#F8FAFC` (Slate 50) | `#1E293B` (Slate 800) | カード背景 |
| Text | `#1E293B` (Slate 800) | `#F1F5F9` (Slate 100) | テキスト |

---

## §8. テスト方針 [DETAIL]

| テスト種別 | 対象 | ツール |
|----------|------|-------|
| コンポーネントテスト | 各UIコンポーネントの表示・操作 | Vitest + Vue Test Utils |
| ビジュアルリグレッション | 画面スクリーンショット比較 | Playwright |
| E2Eテスト | ユーザーフロー全体 | Playwright |

- 全画面のレスポンシブ表示を3ブレークポイント（PC/タブレット/SP）でテストすること（MUST）
- ロール別ビューの切替が正しく動作することを検証すること（MUST）

---

## §9. アクセシビリティ方針 [DETAIL]

- WAI-ARIA属性を適切に設定すること（SHOULD）
- キーボードナビゲーションをサポートすること（SHOULD）
- 色コントラスト比はWCAG 2.1 AA基準を満たすこと（SHOULD）

---

## §10. パフォーマンス目標 [DETAIL]

| 指標 | 目標値 |
|------|-------|
| LCP (Largest Contentful Paint) | < 2.5秒 |
| FID (First Input Delay) | < 100ms |
| CLS (Cumulative Layout Shift) | < 0.1 |

---

## §11. 実装優先順位 [DETAIL]

1. Phase 1（MVP）: 認証画面 + ダッシュボード + イベント管理画面
2. Phase 1.5: 参加者ポータル + AIアシスタントPanel
3. Phase 2: 管理画面 + 高度なフィルタ・検索UI

---

## §12. 未解決課題（Open Questions） [DETAIL]

| ID | 課題 | 影響範囲 | 担当 |
|----|------|---------|------|
| UI-OQ-001 | ダークモードの初期実装タイミング | 全画面 | 技術 |
| UI-OQ-002 | モバイルファーストかデスクトップファーストか | レイアウト設計 | プロダクト |

---

## 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|-------|
| 2026-02-12 | フレームワーク形式適合（§記法、RFC 2119、レイヤーラベル、§8-§12追加） | AI |
| 2026-02-06 | 初版作成（40+画面・5状態遷移・コンポーネント設計） | AI |
