# NOTIF-001-002: é€šçŸ¥æ©Ÿèƒ½ï¼ˆãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãƒ»ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ï¼‰

## Â§1 æ¦‚è¦

### [CORE] æ©Ÿèƒ½ID
- NOTIF-001: ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ»ç· ã‚åˆ‡ã‚Šãƒ»æ¡ˆå†…ï¼‰
- NOTIF-002: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ï¼ˆãƒˆãƒ¼ã‚¹ãƒˆï¼‰

### [CORE] æ©Ÿèƒ½å
é€šçŸ¥æ©Ÿèƒ½ï¼ˆNotification Systemï¼‰

### [CORE] æ©Ÿèƒ½æ¦‚è¦
ã‚¤ãƒ™ãƒ³ãƒˆé‹å–¶ã«é–¢ã‚ã‚‹ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ã€ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆã€ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°é€šçŸ¥ã‚’ãƒ¡ãƒ¼ãƒ«ãŠã‚ˆã³ã‚¢ãƒ—ãƒªå†…ï¼ˆãƒˆãƒ¼ã‚¹ãƒˆãƒ»é€šçŸ¥ãƒ‘ãƒãƒ«ï¼‰ã§ç¢ºå®Ÿã«é…ä¿¡ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦‹é€ƒã—ã‚’é˜²ãé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã€‚

### [CORE] é–¢é€£ä»•æ§˜
- SSOT-3 APIè¦ç´„ Â§2.13ï¼ˆé€šçŸ¥APIï¼‰
- SSOT-4 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« Â§2.10ï¼ˆnotificationãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
- SSOT-5 æ¨ªæ–­çš„é–¢å¿ƒäº‹ Â§4ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
- AUTH-001: ãƒ­ã‚°ã‚¤ãƒ³ãƒ»èªè¨¼ï¼ˆé€šçŸ¥å…ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç‰¹å®šï¼‰
- EVT-001: ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ»ç·¨é›†ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°é€šçŸ¥ï¼‰
- TASK-001: ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ï¼‰

### [CORE] å‰ææ¡ä»¶
- Nuxt 3 + Nitro Serverç’°å¢ƒ
- Nuxt UI v3ï¼ˆuseToastã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºï¼‰
- PostgreSQL 16ï¼ˆnotificationãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
- Better Authï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»è­˜åˆ¥ï¼‰
- nodemailer ã¾ãŸã¯é¡ä¼¼ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- Redis or Bullmqï¼ˆéåŒæœŸé€šçŸ¥ã‚­ãƒ¥ãƒ¼ã€SHOULDï¼‰

---

## Â§2 ç›®çš„

### [CORE] ãƒ“ã‚¸ãƒã‚¹ç›®çš„
- ã‚¤ãƒ™ãƒ³ãƒˆé‹å–¶ã«ãŠã‘ã‚‹ã€Œã‚¿ã‚¹ã‚¯å¿˜ã‚Œã€ã€Œç· ã‚åˆ‡ã‚Šè¶…éã€ã€Œæƒ…å ±æœªé”ã€ã‚’é˜²ã
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å¿…è¦ãªæƒ…å ±ã‚’å—ã‘å–ã‚Œã‚‹ä»•çµ„ã¿ã‚’æä¾›
- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆãƒ—ãƒƒã‚·ãƒ¥å‹ï¼‰ã¨ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ï¼ˆãƒ—ãƒ«å‹ï¼‰ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰é…ä¿¡ã§ç¢ºå®Ÿæ€§ã‚’æ‹…ä¿

### [CORE] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤
- ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®å‰æ—¥ã«ãƒªãƒã‚¤ãƒ³ãƒ‰â†’ã€Œã†ã£ã‹ã‚Šå¿˜ã‚Œã€ã‚’é˜²ã
- ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°ã‚’ãƒ¡ãƒ¼ãƒ«ã§ã‚­ãƒ£ãƒƒãƒâ†’å¤–å‡ºä¸­ã§ã‚‚æƒ…å ±å…¥æ‰‹
- ã‚¢ãƒ—ãƒªå†…æ“ä½œï¼ˆä¿å­˜æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼ï¼‰ã‚’å³åº§ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯â†’UXå‘ä¸Š

### [CORE] KPI
- ã‚¿ã‚¹ã‚¯æœŸæ—¥éµå®ˆç‡: 85% ä»¥ä¸Š
- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥é–‹å°ç‡: 30% ä»¥ä¸Š
- é€šçŸ¥æœªèª­ç‡ï¼ˆ24hä»¥å†…ï¼‰: 20% ä»¥ä¸‹
- ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºå¾Œã®æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†ç‡: 70% ä»¥ä¸Š

---

## Â§3 æ©Ÿèƒ½è¦ä»¶

### [CORE] å¿…é ˆæ©Ÿèƒ½ï¼ˆMUSTï¼‰

#### FR-001: ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®1æ—¥å‰ï¼ˆD-1ï¼‰ã«è‡ªå‹•ã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- ä»¶å: `[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®ãƒªãƒã‚¤ãƒ³ãƒ‰: {ã‚¿ã‚¹ã‚¯å}`
- æœ¬æ–‡: ã‚¿ã‚¹ã‚¯åã€æœŸæ—¥ã€ã‚¤ãƒ™ãƒ³ãƒˆåã€ã‚¿ã‚¹ã‚¯è©³ç´°ã¸ã®ãƒªãƒ³ã‚¯
- é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°: æ¯æ—¥ 09:00ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ãƒãƒƒãƒå®Ÿè¡Œ
- é€ä¿¡å¯¾è±¡: ã‚¿ã‚¹ã‚¯æ‹…å½“è€…ï¼ˆuser_idï¼‰
- é…ä¿¡ãƒãƒ£ãƒãƒ«: `sent_via = 'email'` or `'both'`

#### FR-002: ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- ã‚¿ã‚¹ã‚¯æœŸæ—¥ã‚’éãã¦ã‚‚æœªå®Œäº†ã®å ´åˆã€å½“æ—¥ 09:00 ã«ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
- ä»¶å: `[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] âš ï¸ ã‚¿ã‚¹ã‚¯æœŸæ—¥è¶…é: {ã‚¿ã‚¹ã‚¯å}`
- æœ¬æ–‡: ã‚¿ã‚¹ã‚¯åã€æœŸæ—¥ã€è¶…éæ—¥æ•°ã€ã‚¿ã‚¹ã‚¯è©³ç´°ã¸ã®ãƒªãƒ³ã‚¯
- é€ä¿¡å¯¾è±¡: ã‚¿ã‚¹ã‚¯æ‹…å½“è€…ï¼ˆuser_idï¼‰
- é…ä¿¡ãƒãƒ£ãƒãƒ«: `sent_via = 'email'` or `'both'`

#### FR-003: ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ï¼ˆæ—¥æ™‚ãƒ»ä¼šå ´ãƒ»è©³ç´°ï¼‰ãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã€é–¢ä¿‚è€…å…¨å“¡ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- ä»¶å: `[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ: {ã‚¤ãƒ™ãƒ³ãƒˆå}`
- æœ¬æ–‡: ã‚¤ãƒ™ãƒ³ãƒˆåã€æ›´æ–°æ—¥æ™‚ã€å¤‰æ›´å†…å®¹ã‚µãƒãƒªã€ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã¸ã®ãƒªãƒ³ã‚¯
- é€ä¿¡å¯¾è±¡: ã‚¤ãƒ™ãƒ³ãƒˆãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ï¼ˆevent_members.user_idï¼‰
- é…ä¿¡ãƒãƒ£ãƒãƒ«: `sent_via = 'email'` or `'both'`

#### FR-004: ã‚¢ãƒ—ãƒªå†…ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ï¼ˆæ“ä½œãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œï¼ˆä¿å­˜ãƒ»å‰Šé™¤ãƒ»æ‹›å¾…é€ä¿¡ãªã©ï¼‰ã®æˆåŠŸãƒ»å¤±æ•—ã‚’å³åº§ã«ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
- ãƒˆãƒ¼ã‚¹ãƒˆã‚¿ã‚¤ãƒ—: success / error / warning / info
- è¡¨ç¤ºå†…å®¹: æ“ä½œçµæœã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä¾‹: "ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ"ï¼‰
- è¡¨ç¤ºä½ç½®: ç”»é¢å³ä¸Šï¼ˆNuxt UI ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- è‡ªå‹•æ¶ˆå»: 5ç§’å¾Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€ã‚¿ã‚¤ãƒ—ã«ã‚ˆã‚Šå¤‰æ›´å¯èƒ½ï¼‰

#### FR-005: ãƒˆãƒ¼ã‚¹ãƒˆè‡ªå‹•æ¶ˆå»
- ãƒˆãƒ¼ã‚¹ãƒˆã¯è¡¨ç¤ºå¾Œ 5ç§’ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‡ªå‹•æ¶ˆå»
- ã‚¿ã‚¤ãƒ—ã”ã¨ã®æ¨å¥¨è¡¨ç¤ºæ™‚é–“:
  - success: 3ç§’
  - info: 5ç§’
  - warning: 7ç§’
  - error: æ‰‹å‹•æ¶ˆå»ï¼ˆ0 = è‡ªå‹•æ¶ˆå»ãªã—ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§é–‰ã˜ã‚‹ã“ã¨ã‚‚å¯èƒ½

#### FR-006: ãƒˆãƒ¼ã‚¹ãƒˆã‚¿ã‚¤ãƒ—
- `success`: æˆåŠŸæ“ä½œï¼ˆç·‘ãƒ»ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- `error`: ã‚¨ãƒ©ãƒ¼ãƒ»å¤±æ•—ï¼ˆèµ¤ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- `warning`: è­¦å‘Šï¼ˆé»„ãƒ»æ³¨æ„ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- `info`: æƒ…å ±ï¼ˆé’ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ã‚¢ã‚¤ã‚³ãƒ³ï¼‰

#### FR-007: æœªèª­é€šçŸ¥ãƒãƒƒã‚¸è¡¨ç¤º
- ãƒ˜ãƒƒãƒ€ãƒ¼ã®é€šçŸ¥ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã«æœªèª­ä»¶æ•°ãƒãƒƒã‚¸ã‚’è¡¨ç¤º
- æœªèª­ä»¶æ•°ã¯ `GET /api/v1/notifications/unread-count` ã‹ã‚‰å–å¾—
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°: 5ç§’ã”ã¨ã«ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆã¾ãŸã¯ WebSocketã€SHOULDï¼‰
- ãƒãƒƒã‚¸ã¯æœªèª­ä»¶æ•°ãŒ 0 ã®å ´åˆã¯éè¡¨ç¤º

#### FR-008: é€šçŸ¥ã‚’æ—¢èª­ã«ã™ã‚‹
- é€šçŸ¥ä¸€è¦§ã§é€šçŸ¥ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ—¢èª­åŒ–ï¼ˆ`is_read = true`, `read_at = now()`ï¼‰
- API: `PATCH /api/v1/notifications/:id/read`
- æ—¢èª­åŒ–å¾Œã€ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆãŒæ¸›å°‘

#### FR-009: ã™ã¹ã¦æ—¢èª­ã«ã™ã‚‹
- é€šçŸ¥ãƒ‘ãƒãƒ«ã®ã€Œã™ã¹ã¦æ—¢èª­ã€ãƒœã‚¿ãƒ³ã§æœªèª­é€šçŸ¥ã‚’ä¸€æ‹¬æ—¢èª­åŒ–
- API: `POST /api/v1/notifications/read-all`
- å®Ÿè¡Œå¾Œã€ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆãŒ 0 ã«ãªã‚‹

#### FR-010: ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆSHOULDâ†’MUSTæ¨å¥¨ï¼‰
- ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ï¼ˆEJS / Handlebars ãªã©ï¼‰
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¾‹:
  - `task-reminder.html`
  - `task-overdue.html`
  - `event-update.html`
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°: `{userName}`, `{taskName}`, `{eventName}`, `{dueDate}`, `{link}` ãªã©
- HTMLå½¢å¼ãƒ¡ãƒ¼ãƒ«ï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ fallback ä»˜ãï¼‰

### [DETAIL] æ¨å¥¨æ©Ÿèƒ½ï¼ˆSHOULDï¼‰

#### FR-011: é€šçŸ¥è¨­å®šï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã® ON/OFF ã‚’è¨­å®šå¯èƒ½
- è¨­å®šé …ç›®: ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ / ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆ / ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã™ã¹ã¦ ON

#### FR-012: é€šçŸ¥å±¥æ­´ã®ä¿æŒæœŸé–“
- é€šçŸ¥ã¯ä½œæˆå¾Œ 90æ—¥é–“ä¿æŒ
- 90æ—¥çµŒéã—ãŸé€šçŸ¥ã¯å‰Šé™¤ï¼ˆãƒãƒƒãƒå‡¦ç†ï¼‰

#### FR-013: é€šçŸ¥ã®å„ªå…ˆåº¦ï¼ˆPriorityï¼‰
- é€šçŸ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã« `priority` ã‚«ãƒ©ãƒ ï¼ˆhigh / medium / lowï¼‰ã‚’è¿½åŠ 
- é«˜å„ªå…ˆåº¦é€šçŸ¥ã¯ãƒãƒƒã‚¸è‰²ã‚’å¤‰ãˆã‚‹ã€é€šçŸ¥éŸ³ã‚’é³´ã‚‰ã™ãªã©

### [DETAIL] å°†æ¥æ©Ÿèƒ½ï¼ˆMAYï¼‰

#### FR-014: Slack / Teams é€£æº
- ãƒ¡ãƒ¼ãƒ«ä»¥å¤–ã®é…ä¿¡ãƒãƒ£ãƒãƒ«ï¼ˆSlack Webhook, Microsoft Teams Incoming Webhookï¼‰

#### FR-015: WebSocket ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- ãƒãƒ¼ãƒªãƒ³ã‚°ã§ã¯ãªã WebSocket ã§é€šçŸ¥ã‚’ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡

#### FR-016: é€šçŸ¥ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»æ¤œç´¢
- é€šçŸ¥ä¸€è¦§ã§ã€Œæœªèª­ã®ã¿ã€ã€Œã‚¿ã‚¹ã‚¯é€šçŸ¥ã®ã¿ã€ãªã©ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½

### Â§3-E: å…¥å‡ºåŠ›ä¾‹ [CONTRACT]

> é€šçŸ¥APIã®ä¸»è¦ãªå…¥å‡ºåŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ã‚’ç¶²ç¾…ï¼‰

#### E-1: é€šçŸ¥ä¸€è¦§å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
  GET /api/v1/notifications?limit=20&offset=0
  Authorization: Bearer {session_token}

ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 200 OK
  {
    "notifications": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440001",
        "type": "task_reminder",
        "title": "ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®ãƒªãƒã‚¤ãƒ³ãƒ‰: ä¼šå ´äºˆç´„",
        "body": "ã‚¿ã‚¹ã‚¯ã€Œä¼šå ´äºˆç´„ã€ã®æœŸæ—¥ã¯æ˜æ—¥ã§ã™ã€‚",
        "is_read": false,
        "event_id": "550e8400-e29b-41d4-a716-446655440010",
        "created_at": "2026-02-08T09:00:00Z"
      }
    ],
    "total": 42,
    "limit": 20,
    "offset": 0
  }
```

#### E-2: æœªèª­ãƒ•ã‚£ãƒ«ã‚¿
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
  GET /api/v1/notifications?is_read=false
  Authorization: Bearer {session_token}

ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 200 OK
  {
    "notifications": [/* æœªèª­é€šçŸ¥ã®ã¿ */],
    "total": 5,
    "limit": 20,
    "offset": 0
  }
```

#### E-3: æœªèª­ä»¶æ•°å–å¾—
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
  GET /api/v1/notifications/unread-count
  Authorization: Bearer {session_token}

ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 200 OK
  {
    "unread_count": 5
  }
```

#### E-4: é€šçŸ¥æ—¢èª­åŒ–
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
  PATCH /api/v1/notifications/550e8400-e29b-41d4-a716-446655440001/read
  Authorization: Bearer {session_token}

ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 200 OK
  {
    "id": "550e8400-e29b-41d4-a716-446655440001",
    "is_read": true,
    "read_at": "2026-02-09T10:30:00Z"
  }
```

#### E-5: å…¨ä»¶æ—¢èª­
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
  POST /api/v1/notifications/read-all
  Authorization: Bearer {session_token}

ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 200 OK
  {
    "updated_count": 12
  }
```

#### E-6: ä»–äººã®é€šçŸ¥æ—¢èª­åŒ–è©¦è¡Œ
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:
  PATCH /api/v1/notifications/other-user-notification-id/read
  Authorization: Bearer {session_token}

ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 403 Forbidden
  {
    "error": {
      "code": "NOTIF_FORBIDDEN",
      "message": "ã“ã®é€šçŸ¥ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“"
    }
  }
```

#### E-7: ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºï¼ˆsuccessï¼‰
```
ãƒˆãƒªã‚¬ãƒ¼: ã‚¤ãƒ™ãƒ³ãƒˆä¿å­˜æˆåŠŸ
è¡¨ç¤º:
  ã‚¿ã‚¤ãƒ—: successï¼ˆç·‘ãƒ»ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: "ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ"
  è¡¨ç¤ºæ™‚é–“: 3ç§’ï¼ˆè‡ªå‹•æ¶ˆå»ï¼‰
  ä½ç½®: ç”»é¢å³ä¸Š
```

#### E-8: ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºï¼ˆerrorï¼‰
```
ãƒˆãƒªã‚¬ãƒ¼: APIå‘¼ã³å‡ºã—å¤±æ•—ï¼ˆ500 Internal Server Errorï¼‰
è¡¨ç¤º:
  ã‚¿ã‚¤ãƒ—: errorï¼ˆèµ¤ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰
  ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: "ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ"
  è¡¨ç¤ºæ™‚é–“: æ‰‹å‹•æ¶ˆå»ï¼ˆè‡ªå‹•æ¶ˆå»ãªã—ï¼‰
  ä½ç½®: ç”»é¢å³ä¸Š
  è¿½åŠ UI: [å†è©¦è¡Œ] [âœ•] ãƒœã‚¿ãƒ³
```

### Â§3-F: å¢ƒç•Œå€¤ [CONTRACT]

| é …ç›® | æœ€å°å€¤ | æœ€å¤§å€¤ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | å‚™è€ƒ |
|------|--------|--------|------------|------|
| title | 1æ–‡å­— | 200æ–‡å­— | - | ç©ºæ–‡å­—ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ |
| body | 1æ–‡å­— | 2000æ–‡å­— | - | ç©ºæ–‡å­—ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ |
| limitï¼ˆä¸€è¦§å–å¾—ï¼‰ | 1 | 100 | 20 | ç¯„å›²å¤–ã¯ 400 ã‚¨ãƒ©ãƒ¼ |
| offsetï¼ˆä¸€è¦§å–å¾—ï¼‰ | 0 | - | 0 | è² å€¤ã¯ 400 ã‚¨ãƒ©ãƒ¼ |
| unread_count ãƒãƒƒã‚¸è¡¨ç¤º | 0 | - | - | 0â†’ãƒãƒƒã‚¸éè¡¨ç¤º, 1-99â†’æ•°å€¤è¡¨ç¤º, 100ä»¥ä¸Šâ†’"99+" |
| ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºæ™‚é–“ï¼ˆsuccessï¼‰ | - | - | 3ç§’ | è‡ªå‹•æ¶ˆå» |
| ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºæ™‚é–“ï¼ˆinfoï¼‰ | - | - | 5ç§’ | è‡ªå‹•æ¶ˆå» |
| ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºæ™‚é–“ï¼ˆwarningï¼‰ | - | - | 7ç§’ | è‡ªå‹•æ¶ˆå» |
| ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºæ™‚é–“ï¼ˆerrorï¼‰ | - | - | 0ç§’ | æ‰‹å‹•æ¶ˆå»ã®ã¿ |
| é€šçŸ¥ä¿æŒæœŸé–“ | - | 90æ—¥ | - | è¶…éåˆ†ã¯å‰Šé™¤ãƒãƒƒãƒã§è‡ªå‹•å‰Šé™¤ |
| 1åˆ†é–“é€šçŸ¥é€ä¿¡ä¸Šé™ | - | 10ä»¶/ãƒ¦ãƒ¼ã‚¶ãƒ¼ | - | è¶…éåˆ†ã¯é€ä¿¡é…å»¶ |

### Â§3-G: ä¾‹å¤–å¿œç­” [CONTRACT]

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ç™ºç”Ÿæ¡ä»¶ |
|--------------|----------------|------------|----------|
| NOTIF_NOT_FOUND | 404 | é€šçŸ¥ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ | æŒ‡å®šIDã®é€šçŸ¥ãŒå­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯å‰Šé™¤æ¸ˆã¿ |
| NOTIF_FORBIDDEN | 403 | ã“ã®é€šçŸ¥ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ | ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é€šçŸ¥ã«å¯¾ã™ã‚‹æ—¢èª­åŒ–ãƒ»å–å¾—æ“ä½œ |
| NOTIF_MAIL_FAILED | 500 | ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã»ã©å†è©¦è¡Œã•ã‚Œã¾ã™ | SMTPæ¥ç¶šã‚¨ãƒ©ãƒ¼ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—ç­‰ |
| NOTIF_INVALID_TYPE | 400 | é€šçŸ¥ã‚¿ã‚¤ãƒ—ãŒä¸æ­£ã§ã™ | type ã«æœªå®šç¾©ã®å€¤ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆ |
| UNAUTHORIZED | 401 | èªè¨¼ãŒå¿…è¦ã§ã™ | Bearer Token æœªé€ä¿¡ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™åˆ‡ã‚Œ |
| RATE_LIMIT | 429 | ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒä¸Šé™ã‚’è¶…ãˆã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ | é€šçŸ¥API 100req/min ã‚’è¶…é |

### Â§3-H: å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆï¼ˆGherkinï¼‰ [CONTRACT]

> å…¨MUSTã‚·ãƒŠãƒªã‚ªã®Gherkinå½¢å¼ãƒ†ã‚¹ãƒˆ

#### AT-NOTIF-001: é€šçŸ¥ä¸€è¦§å–å¾—ï¼ˆæœªèª­ã®ã¿ï¼‰
```gherkin
Scenario: æœªèª­é€šçŸ¥ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿å–å¾—ã™ã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚‹
  And ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«æœªèª­é€šçŸ¥ãŒ3ä»¶ã€æ—¢èª­é€šçŸ¥ãŒ2ä»¶ã‚ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒ GET /api/v1/notifications?is_read=false ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹
  Then ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ 200 ãŒè¿”ã‚‹
  And ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® notifications ã¯3ä»¶ã§ã‚ã‚‹
  And ã™ã¹ã¦ã®é€šçŸ¥ã® is_read ãŒ false ã§ã‚ã‚‹
```

#### AT-NOTIF-002: é€šçŸ¥æ—¢èª­åŒ– + ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆæ¸›å°‘
```gherkin
Scenario: é€šçŸ¥ã‚’æ—¢èª­ã«ã™ã‚‹ã¨ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆãŒæ¸›å°‘ã™ã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚‹
  And ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«æœªèª­é€šçŸ¥ãŒ5ä»¶ã‚ã‚‹
  And ãƒ˜ãƒƒãƒ€ãƒ¼ã®é€šçŸ¥ãƒãƒƒã‚¸ã« "5" ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒé€šçŸ¥ãƒ‘ãƒãƒ«ã®1ä»¶ç›®ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
  Then å½“è©²é€šçŸ¥ã® is_read ãŒ true ã«ãªã‚‹
  And å½“è©²é€šçŸ¥ã® read_at ãŒè¨­å®šã•ã‚Œã‚‹
  And ãƒ˜ãƒƒãƒ€ãƒ¼ã®é€šçŸ¥ãƒãƒƒã‚¸ã« "4" ã¨è¡¨ç¤ºã•ã‚Œã‚‹
```

#### AT-NOTIF-003: å…¨ä»¶æ—¢èª­ + ãƒãƒƒã‚¸æ¶ˆå»
```gherkin
Scenario: ã™ã¹ã¦æ—¢èª­ãƒœã‚¿ãƒ³ã§æœªèª­é€šçŸ¥ãŒå…¨éƒ¨æ—¢èª­ã«ãªã‚Šãƒãƒƒã‚¸ãŒæ¶ˆãˆã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚‹
  And ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«æœªèª­é€šçŸ¥ãŒ8ä»¶ã‚ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒé€šçŸ¥ãƒ‘ãƒãƒ«ã®ã€Œã™ã¹ã¦æ—¢èª­ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
  Then POST /api/v1/notifications/read-all ãŒå®Ÿè¡Œã•ã‚Œã‚‹
  And ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® updated_count ãŒ 8 ã§ã‚ã‚‹
  And ãƒ˜ãƒƒãƒ€ãƒ¼ã®é€šçŸ¥ãƒãƒƒã‚¸ãŒéè¡¨ç¤ºã«ãªã‚‹
```

#### AT-NOTIF-004: ä»–äººã®é€šçŸ¥ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
```gherkin
Scenario: ä»–äººã®é€šçŸ¥ã‚’æ—¢èª­åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹ã¨403ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚‹
  And ãƒ¦ãƒ¼ã‚¶ãƒ¼Bã®é€šçŸ¥ID "notif-b-001" ãŒå­˜åœ¨ã™ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒ PATCH /api/v1/notifications/notif-b-001/read ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹
  Then ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ 403 ãŒè¿”ã‚‹
  And ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ "NOTIF_FORBIDDEN" ãŒè¿”ã‚‹
  And å½“è©²é€šçŸ¥ã® is_read ã¯ false ã®ã¾ã¾ã§ã‚ã‚‹
```

#### AT-NOTIF-005: é€šçŸ¥ãƒ™ãƒ«ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒ‘ãƒãƒ«è¡¨ç¤º
```gherkin
Scenario: é€šçŸ¥ãƒ™ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨é€šçŸ¥ãƒ‘ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹
  And ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«é€šçŸ¥ãŒ3ä»¶ã‚ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒ˜ãƒƒãƒ€ãƒ¼ã®é€šçŸ¥ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
  Then é€šçŸ¥ãƒ‘ãƒãƒ«ãŒãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¡¨ç¤ºã•ã‚Œã‚‹
  And æœ€æ–°5ä»¶ã®é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹
  And æœªèª­é€šçŸ¥ã«ã¯ "â—" ãƒãƒ¼ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

#### AT-NOTIF-006: é€šçŸ¥ãƒ‘ãƒãƒ«ã‚¯ãƒªãƒƒã‚¯ â†’ æ—¢èª­åŒ–+ãƒšãƒ¼ã‚¸é·ç§»
```gherkin
Scenario: é€šçŸ¥ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ—¢èª­åŒ–ã•ã‚Œé–¢é€£ãƒšãƒ¼ã‚¸ã¸é·ç§»ã™ã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒé€šçŸ¥ãƒ‘ãƒãƒ«ã‚’é–‹ã„ã¦ã„ã‚‹
  And æœªèª­é€šçŸ¥ "ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°: æ˜¥å­£ã‚»ãƒŸãƒŠãƒ¼" ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ï¼ˆevent_id ä»˜ãï¼‰
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒå½“è©²é€šçŸ¥ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
  Then PATCH /api/v1/notifications/:id/read ãŒå®Ÿè¡Œã•ã‚Œã‚‹
  And å½“è©²é€šçŸ¥ãŒæ—¢èª­ã«ãªã‚‹
  And /events/{event_id} ãƒšãƒ¼ã‚¸ã¸é·ç§»ã™ã‚‹
  And é€šçŸ¥ãƒ‘ãƒãƒ«ãŒé–‰ã˜ã‚‹
```

#### AT-NOTIF-007: ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆsuccessï¼‰è¡¨ç¤º + 3ç§’è‡ªå‹•æ¶ˆå»
```gherkin
Scenario: æˆåŠŸãƒˆãƒ¼ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œ3ç§’å¾Œã«è‡ªå‹•æ¶ˆå»ã•ã‚Œã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒã‚¤ãƒ™ãƒ³ãƒˆä½œæˆç”»é¢ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã™ã‚‹
  And API ãŒ 200 ã‚’è¿”ã™
  Then ç·‘è‰²ã®ãƒˆãƒ¼ã‚¹ãƒˆ "ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ" ãŒç”»é¢å³ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹
  And 3ç§’å¾Œã«ãƒˆãƒ¼ã‚¹ãƒˆãŒè‡ªå‹•æ¶ˆå»ã•ã‚Œã‚‹
```

#### AT-NOTIF-008: ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆerrorï¼‰è¡¨ç¤º + æ‰‹å‹•æ¶ˆå»
```gherkin
Scenario: ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œæ‰‹å‹•ã§ã®ã¿æ¶ˆå»ã§ãã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒã‚¤ãƒ™ãƒ³ãƒˆä½œæˆç”»é¢ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã™ã‚‹
  And API ãŒ 500 ã‚’è¿”ã™
  Then èµ¤è‰²ã®ãƒˆãƒ¼ã‚¹ãƒˆ "ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ" ãŒç”»é¢å³ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹
  And 10ç§’å¾Œã‚‚ãƒˆãƒ¼ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã¾ã¾ã§ã‚ã‚‹
  When ãƒ¦ãƒ¼ã‚¶ãƒ¼AãŒãƒˆãƒ¼ã‚¹ãƒˆã® [âœ•] ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
  Then ãƒˆãƒ¼ã‚¹ãƒˆãŒæ¶ˆå»ã•ã‚Œã‚‹
```

#### AT-NOTIF-009: ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
```gherkin
Scenario: ã‚¿ã‚¹ã‚¯æœŸæ—¥å‰æ—¥ã«ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«æ‹…å½“ã‚¿ã‚¹ã‚¯ "ä¼šå ´äºˆç´„" ãŒã‚ã‚‹
  And ã‚¿ã‚¹ã‚¯ã®æœŸæ—¥ãŒæ˜æ—¥ã§ã‚ã‚‹
  And ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ "pending" ã§ã‚ã‚‹
  When ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒãŒ09:00ã«å®Ÿè¡Œã•ã‚Œã‚‹
  Then ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã‚‹
  And ãƒ¡ãƒ¼ãƒ«ä»¶åã« "ä¼šå ´äºˆç´„" ãŒå«ã¾ã‚Œã‚‹
  And notification ãƒ†ãƒ¼ãƒ–ãƒ«ã« type="task_reminder" ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹
  And ã‚¿ã‚¹ã‚¯ã® reminder_sent ãŒ true ã«ãªã‚‹
```

#### AT-NOTIF-010: ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒƒãƒ â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
```gherkin
Scenario: ã‚¿ã‚¹ã‚¯æœŸæ—¥è¶…éæ™‚ã«ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«æ‹…å½“ã‚¿ã‚¹ã‚¯ "æ©Ÿææ‰‹é…" ãŒã‚ã‚‹
  And ã‚¿ã‚¹ã‚¯ã®æœŸæ—¥ãŒæ˜¨æ—¥ã§ã‚ã‚‹
  And ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ "pending" ã§ã‚ã‚‹
  When ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒƒãƒãŒ09:00ã«å®Ÿè¡Œã•ã‚Œã‚‹
  Then ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã‚‹
  And ãƒ¡ãƒ¼ãƒ«ä»¶åã« "æœŸæ—¥è¶…é" ã¨ "æ©Ÿææ‰‹é…" ãŒå«ã¾ã‚Œã‚‹
  And notification ãƒ†ãƒ¼ãƒ–ãƒ«ã« type="task_overdue" ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹
```

#### AT-NOTIF-011: å®Œäº†ã‚¿ã‚¹ã‚¯ â†’ ãƒªãƒã‚¤ãƒ³ãƒ‰ä¸é€ä¿¡
```gherkin
Scenario: å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ã«ã¯ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’é€ä¿¡ã—ãªã„
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«æ‹…å½“ã‚¿ã‚¹ã‚¯ "ä¼šå ´äºˆç´„" ãŒã‚ã‚‹
  And ã‚¿ã‚¹ã‚¯ã®æœŸæ—¥ãŒæ˜æ—¥ã§ã‚ã‚‹
  And ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ "completed" ã§ã‚ã‚‹
  When ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒãŒ09:00ã«å®Ÿè¡Œã•ã‚Œã‚‹
  Then ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ¡ãƒ¼ãƒ«ã¯é€ä¿¡ã•ã‚Œãªã„
  And notification ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ä½œæˆã•ã‚Œãªã„
```

#### AT-NOTIF-012: æœªèª­100ä»¶è¶… â†’ è‡ªå‹•æ—¢èª­åŒ–
```gherkin
Scenario: æœªèª­é€šçŸ¥ãŒ100ä»¶ã‚’è¶…ãˆã‚‹ã¨å¤ã„æœªèª­é€šçŸ¥ãŒè‡ªå‹•æ—¢èª­åŒ–ã•ã‚Œã‚‹
  Given ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã«æœªèª­é€šçŸ¥ãŒ105ä»¶ã‚ã‚‹
  When æ–°ã—ã„é€šçŸ¥ãŒä½œæˆã•ã‚Œã‚‹
  Then ãƒ¦ãƒ¼ã‚¶ãƒ¼Aã®æœªèª­é€šçŸ¥ãŒå¤ã„é †ã«è‡ªå‹•æ—¢èª­åŒ–ã•ã‚Œã‚‹
  And æœªèª­é€šçŸ¥ä»¶æ•°ãŒ100ä»¶ä»¥ä¸‹ã«ãªã‚‹
  And é€šçŸ¥ãƒãƒƒã‚¸ã« "99+" ã¨è¡¨ç¤ºã•ã‚Œã‚‹
```

---

## Â§4 ãƒ‡ãƒ¼ã‚¿ä»•æ§˜

### [CORE] ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

#### notification ãƒ†ãƒ¼ãƒ–ãƒ«
SSOT-4 Â§2.10 ã«å®šç¾©æ¸ˆã¿ã€‚å†æ²:

```sql
CREATE TABLE notification (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID NOT NULL REFERENCES tenant(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES user(id) ON DELETE CASCADE,
  event_id UUID REFERENCES event(id) ON DELETE CASCADE, -- nullableï¼ˆã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ã®å ´åˆï¼‰
  type VARCHAR(50) NOT NULL, -- 'task_reminder' | 'task_overdue' | 'event_update' | 'system'
  title VARCHAR(200) NOT NULL,
  body TEXT NOT NULL,
  is_read BOOLEAN DEFAULT FALSE,
  sent_via VARCHAR(20) NOT NULL DEFAULT 'in_app', -- 'in_app' | 'email' | 'both'
  email_sent_at TIMESTAMP,
  read_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_notification_user_unread ON notification(user_id, is_read) WHERE is_read = FALSE;
CREATE INDEX idx_notification_created ON notification(created_at DESC);
```

### [CONTRACT] é€šçŸ¥ã‚¿ã‚¤ãƒ—ï¼ˆtypeï¼‰

| type | èª¬æ˜ | sent_via | ãƒˆãƒªã‚¬ãƒ¼ |
|------|------|----------|----------|
| `task_reminder` | ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ | both | D-1 ãƒãƒƒãƒ |
| `task_overdue` | ã‚¿ã‚¹ã‚¯æœŸæ—¥è¶…é | both | D+0 ãƒãƒƒãƒ |
| `event_update` | ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–° | both | ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†æ™‚ |
| `system` | ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ | in_app | ç®¡ç†è€…æ“ä½œ |

### [CONTRACT] sent_via åˆ¶å¾¡

- `in_app`: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ã®ã¿ï¼ˆnotification ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥ï¼‰
- `email`: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®ã¿ï¼ˆnotification ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯æŒ¿å…¥ã—ãªã„ã€ãƒ­ã‚°ã®ã¿ï¼‰
- `both`: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ + ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆæ¨å¥¨ï¼‰

### [DETAIL] ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­å®šï¼ˆæ¨å¥¨ï¼‰

```typescript
// server/utils/mail-templates.ts
export const MAIL_TEMPLATES = {
  task_reminder: {
    subject: '[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®ãƒªãƒã‚¤ãƒ³ãƒ‰: {{taskName}}',
    template: 'task-reminder.html',
  },
  task_overdue: {
    subject: '[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] âš ï¸ ã‚¿ã‚¹ã‚¯æœŸæ—¥è¶…é: {{taskName}}',
    template: 'task-overdue.html',
  },
  event_update: {
    subject: '[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ: {{eventName}}',
    template: 'event-update.html',
  },
};
```

---

## Â§5 APIä»•æ§˜

### [CORE] API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

SSOT-3 Â§2.13 ã«å®šç¾©æ¸ˆã¿ã€‚ä»¥ä¸‹ã«å†æ² + è©³ç´°åŒ–ã€‚

#### GET /api/v1/notifications

**æ¦‚è¦**: è‡ªåˆ†å®›ã¦ã®é€šçŸ¥ä¸€è¦§ã‚’å–å¾—

**èªè¨¼**: å¿…é ˆï¼ˆBearer Tokenï¼‰

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `limit` (number, optional): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20, æœ€å¤§: 100ï¼‰
- `offset` (number, optional): ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- `is_read` (boolean, optional): æ—¢èª­/æœªèª­ãƒ•ã‚£ãƒ«ã‚¿

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "notifications": [
    {
      "id": "uuid",
      "type": "task_reminder",
      "title": "ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®ãƒªãƒã‚¤ãƒ³ãƒ‰: ä¼šå ´äºˆç´„",
      "body": "ã‚¿ã‚¹ã‚¯ã€Œä¼šå ´äºˆç´„ã€ã®æœŸæ—¥ã¯æ˜æ—¥ã§ã™ã€‚",
      "is_read": false,
      "event_id": "uuid",
      "created_at": "2026-02-08T09:00:00Z"
    }
  ],
  "total": 42,
  "limit": 20,
  "offset": 0
}
```

#### PATCH /api/v1/notifications/:id/read

**æ¦‚è¦**: é€šçŸ¥ã‚’æ—¢èª­ã«ã™ã‚‹

**èªè¨¼**: å¿…é ˆï¼ˆBearer Tokenï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**: ãªã—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "id": "uuid",
  "is_read": true,
  "read_at": "2026-02-09T10:30:00Z"
}
```

#### POST /api/v1/notifications/read-all

**æ¦‚è¦**: æœªèª­é€šçŸ¥ã‚’ã™ã¹ã¦æ—¢èª­ã«ã™ã‚‹

**èªè¨¼**: å¿…é ˆï¼ˆBearer Tokenï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**: ãªã—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "updated_count": 12
}
```

#### GET /api/v1/notifications/unread-count

**æ¦‚è¦**: æœªèª­é€šçŸ¥ä»¶æ•°ã‚’å–å¾—

**èªè¨¼**: å¿…é ˆï¼ˆBearer Tokenï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "unread_count": 5
}
```

### [DETAIL] å†…éƒ¨APIï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰

#### POST /api/internal/notifications/send-email

**æ¦‚è¦**: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’éåŒæœŸã‚­ãƒ¥ãƒ¼ã«æŠ•å…¥ï¼ˆå†…éƒ¨APIã®ã¿ï¼‰

**èªè¨¼**: å†…éƒ¨ã‚µãƒ¼ãƒãƒ¼é–“é€šä¿¡ï¼ˆAPI Key or IPåˆ¶é™ï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "to": "user@example.com",
  "type": "task_reminder",
  "context": {
    "userName": "ç”°ä¸­å¤ªéƒ",
    "taskName": "ä¼šå ´äºˆç´„",
    "dueDate": "2026-02-10",
    "link": "https://hub.example.com/events/xxx/tasks/yyy"
  }
}
```

**å‡¦ç†**:
1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§æœ¬æ–‡ç”Ÿæˆ
2. nodemailer ã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡
3. notification ãƒ†ãƒ¼ãƒ–ãƒ«ã« `email_sent_at` æ›´æ–°
4. ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã«æŠ•å…¥

---

## Â§6 UIä»•æ§˜

### [CORE] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
layouts/
  dashboard.vue               â† ãƒ˜ãƒƒãƒ€ãƒ¼ã« NotificationBell ã‚’é…ç½®
components/
  features/
    notification/
      NotificationBell.vue    â† é€šçŸ¥ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ + ãƒãƒƒã‚¸
      NotificationPanel.vue   â† é€šçŸ¥ä¸€è¦§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
      NotificationItem.vue    â† é€šçŸ¥1ä»¶ã®è¡¨ç¤º
      NotificationToast.vue   â† ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆNuxt UI useToast ã§ä»£æ›¿å¯èƒ½ï¼‰
composables/
  useNotification.ts          â† é€šçŸ¥å–å¾—ãƒ»æ—¢èª­åŒ–ãƒ­ã‚¸ãƒƒã‚¯
```

### [CORE] ç”»é¢æ§‹æˆ

#### 6.1 é€šçŸ¥ãƒ™ãƒ«ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ä¿¡ãƒ—ãƒ©ã‚¹Hub    [æ¤œç´¢]    ğŸ””(5)  [ğŸ‘¤] â”‚  â† ãƒ˜ãƒƒãƒ€ãƒ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†‘
                          é€šçŸ¥ãƒ™ãƒ« + æœªèª­ãƒãƒƒã‚¸(5ä»¶)
```

#### 6.2 é€šçŸ¥ãƒ‘ãƒãƒ«ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€šçŸ¥                   [ã™ã¹ã¦æ—¢èª­]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®ãƒªãƒã‚¤ãƒ³ãƒ‰: ä¼šå ´äºˆç´„      â”‚ â† æœªèª­ï¼ˆâ—ï¼‰
â”‚   æ˜æ—¥ãŒæœŸæ—¥ã§ã™                        â”‚
â”‚   2åˆ†å‰                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ           â”‚ â† æ—¢èª­
â”‚   ã€Œæ˜¥å­£ã‚»ãƒŸãƒŠãƒ¼ã€ã®æ—¥ç¨‹ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸ  â”‚
â”‚   1æ™‚é–“å‰                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   âš ï¸ ã‚¿ã‚¹ã‚¯æœŸæ—¥è¶…é: æ©Ÿææ‰‹é…           â”‚
â”‚   æœŸæ—¥ã‚’1æ—¥éãã¦ã„ã¾ã™                  â”‚
â”‚   3æ™‚é–“å‰                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              [ã™ã¹ã¦è¦‹ã‚‹]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ“ä½œ**:
- é€šçŸ¥ãƒ™ãƒ«ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¡¨ç¤º/éè¡¨ç¤º
- é€šçŸ¥é …ç›®ã‚¯ãƒªãƒƒã‚¯ â†’ æ—¢èª­åŒ– + é–¢é€£ãƒšãƒ¼ã‚¸ã¸é·ç§»ï¼ˆevent_id ãŒã‚ã‚Œã°ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã¸ï¼‰
- [ã™ã¹ã¦æ—¢èª­] â†’ æœªèª­é€šçŸ¥ã‚’ä¸€æ‹¬æ—¢èª­åŒ–
- [ã™ã¹ã¦è¦‹ã‚‹] â†’ `/notifications` ãƒšãƒ¼ã‚¸ã¸é·ç§»ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

#### 6.3 ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºä¾‹

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ âœ… ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ â”‚  â† success (3ç§’)
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ âš ï¸ å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ â”‚  â† warning (7ç§’)
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ       â”‚  â† error (æ‰‹å‹•æ¶ˆå»)
                         â”‚    [å†è©¦è¡Œ]  [âœ•]         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### [CONTRACT] UIæ“ä½œãƒ•ãƒ­ãƒ¼

#### é€šçŸ¥ãƒ‘ãƒãƒ«ã‚’é–‹ã
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã®é€šçŸ¥ãƒ™ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯
2. GET /api/v1/notifications?limit=5&is_read=false ã§æœªèª­é€šçŸ¥ã‚’å–å¾—
3. é€šçŸ¥ãƒ‘ãƒãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¡¨ç¤º
4. æœªèª­é€šçŸ¥ã«ã€Œâ—ã€ãƒãƒ¼ã‚¯ã€æ—¢èª­é€šçŸ¥ã¯ãƒãƒ¼ã‚¯ãªã—
```

#### é€šçŸ¥ã‚’æ—¢èª­ã«ã™ã‚‹
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€šçŸ¥é …ç›®ã‚’ã‚¯ãƒªãƒƒã‚¯
2. PATCH /api/v1/notifications/:id/read ã§æ—¢èª­åŒ–
3. é€šçŸ¥ãƒ‘ãƒãƒ«ã®ã€Œâ—ã€ãƒãƒ¼ã‚¯ã‚’æ¶ˆå»
4. ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆã‚’ -1
5. event_id ãŒã‚ã‚Œã°ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã¸é·ç§»
```

#### ã™ã¹ã¦æ—¢èª­ã«ã™ã‚‹
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ [ã™ã¹ã¦æ—¢èª­] ã‚’ã‚¯ãƒªãƒƒã‚¯
2. POST /api/v1/notifications/read-all
3. é€šçŸ¥ãƒ‘ãƒãƒ«ã®æœªèª­ãƒãƒ¼ã‚¯(â—)ã‚’ã™ã¹ã¦æ¶ˆå»
4. ãƒãƒƒã‚¸ã‚«ã‚¦ãƒ³ãƒˆã‚’ 0 ã«
```

#### ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œï¼ˆä¾‹: ã‚¤ãƒ™ãƒ³ãƒˆä¿å­˜ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼‰
2. APIæˆåŠŸ â†’ useToast().add({ title: 'ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ', color: 'green', timeout: 3000 })
3. APIå¤±æ•— â†’ useToast().add({ title: 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', color: 'red', timeout: 0 })
4. ãƒˆãƒ¼ã‚¹ãƒˆãŒç”»é¢å³ä¸Šã«è¡¨ç¤ºã•ã‚Œã€timeout ç§’å¾Œã«è‡ªå‹•æ¶ˆå»ï¼ˆ0 ã¯æ‰‹å‹•æ¶ˆå»ï¼‰
```

### [DETAIL] Nuxt UI v3 useToast åˆ©ç”¨ä¾‹

```typescript
// composables/useAppToast.ts
export const useAppToast = () => {
  const toast = useToast();

  const showSuccess = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'green',
      icon: 'i-heroicons-check-circle',
      timeout: 3000,
    });
  };

  const showError = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'red',
      icon: 'i-heroicons-exclamation-circle',
      timeout: 0, // æ‰‹å‹•æ¶ˆå»
    });
  };

  const showWarning = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'yellow',
      icon: 'i-heroicons-exclamation-triangle',
      timeout: 7000,
    });
  };

  const showInfo = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'blue',
      icon: 'i-heroicons-information-circle',
      timeout: 5000,
    });
  };

  return { showSuccess, showError, showWarning, showInfo };
};
```

**ä½¿ç”¨ä¾‹**:
```vue
<script setup lang="ts">
const { showSuccess, showError } = useAppToast();

async function saveEvent() {
  try {
    await $fetch('/api/v1/events', { method: 'POST', body: eventData });
    showSuccess('ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
  } catch (error) {
    showError('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', error.message);
  }
}
</script>
```

---

## Â§7 ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«

### [CORE] BR-001: ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®1æ—¥å‰ï¼ˆD-1ï¼‰ã€æ¯æ—¥ 09:00ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã«ãƒãƒƒãƒå®Ÿè¡Œ
- å¯¾è±¡: `task.due_date = CURRENT_DATE + INTERVAL '1 day'` ã‹ã¤ `task.status != 'completed'`
- é€ä¿¡æ¸ˆã¿ãƒ•ãƒ©ã‚°ï¼ˆ`task.reminder_sent`ï¼‰ã§é‡è¤‡é€ä¿¡ã‚’é˜²æ­¢

### [CORE] BR-002: ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ã‚¿ã‚¹ã‚¯æœŸæ—¥å½“æ—¥ã€æ¯æ—¥ 09:00ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã«ãƒãƒƒãƒå®Ÿè¡Œ
- å¯¾è±¡: `task.due_date < CURRENT_DATE` ã‹ã¤ `task.status != 'completed'`
- é€ä¿¡æ¸ˆã¿ãƒ•ãƒ©ã‚°ï¼ˆ`task.overdue_alert_sent`ï¼‰ã§é‡è¤‡é€ä¿¡ã‚’é˜²æ­¢

### [CORE] BR-003: ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°é€šçŸ¥é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ï¼ˆevent.title, event.start_at, event.location ãªã©ï¼‰ãŒæ›´æ–°ã•ã‚ŒãŸç¬é–“ã«éåŒæœŸé€ä¿¡
- å¯¾è±¡: ã‚¤ãƒ™ãƒ³ãƒˆãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ï¼ˆevent_members.user_idï¼‰
- é€ä¿¡ãƒãƒ£ãƒãƒ«: `sent_via = 'both'`ï¼ˆã‚¢ãƒ—ãƒªå†… + ãƒ¡ãƒ¼ãƒ«ï¼‰

### [CORE] BR-004: ãƒˆãƒ¼ã‚¹ãƒˆè‡ªå‹•æ¶ˆå»æ™‚é–“
- success: 3ç§’
- info: 5ç§’
- warning: 7ç§’
- error: 0ç§’ï¼ˆæ‰‹å‹•æ¶ˆå»ã®ã¿ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ [âœ•] ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼‰

### [CORE] BR-005: sent_via ã«ã‚ˆã‚‹ãƒ¡ãƒ¼ãƒ«é€ä¿¡åˆ¶å¾¡
- `sent_via = 'in_app'`: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã—ãªã„ã€notification ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿æŒ¿å…¥
- `sent_via = 'email'`: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®ã¿ã€notification ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯æŒ¿å…¥ã—ãªã„ï¼ˆãƒ­ã‚°ã®ã¿ï¼‰
- `sent_via = 'both'`: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ + notification ãƒ†ãƒ¼ãƒ–ãƒ«æŒ¿å…¥ï¼ˆæ¨å¥¨ï¼‰

### [CORE] BR-006: é€šçŸ¥é…ä¿¡ã®éåŒæœŸå‡¦ç†
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯éåŒæœŸã‚­ãƒ¥ãƒ¼ï¼ˆRedis + Bullmq æ¨å¥¨ï¼‰ã§å‡¦ç†
- é€ä¿¡å¤±æ•—æ™‚ã¯æœ€å¤§3å›ãƒªãƒˆãƒ©ã‚¤ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•: 1åˆ†å¾Œã€5åˆ†å¾Œã€15åˆ†å¾Œï¼‰
- 3å›å¤±æ•—ã—ãŸå ´åˆã¯ç®¡ç†è€…ã«ã‚¢ãƒ©ãƒ¼ãƒˆ

### [DETAIL] BR-007: é€šçŸ¥ã®ä¿æŒæœŸé–“
- é€šçŸ¥ã¯ä½œæˆå¾Œ 90æ—¥é–“ä¿æŒ
- 90æ—¥çµŒéã—ãŸé€šçŸ¥ã¯å‰Šé™¤ãƒãƒƒãƒã§å‰Šé™¤ï¼ˆæ¯æ—¥ 02:00 å®Ÿè¡Œï¼‰

### [DETAIL] BR-008: æœªèª­é€šçŸ¥ã®ä¸Šé™
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šã®æœªèª­é€šçŸ¥ãŒ 100ä»¶ã‚’è¶…ãˆã‚‹å ´åˆã€å¤ã„æœªèª­é€šçŸ¥ã‚’è‡ªå‹•æ—¢èª­åŒ–
- ãƒãƒƒã‚¸è¡¨ç¤ºã¯ã€Œ99+ã€ã¨è¡¨ç¤º

---

## Â§8 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### [CORE] å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

#### é€šçŸ¥ä½œæˆæ™‚
```typescript
const createNotificationSchema = z.object({
  tenant_id: z.string().uuid(),
  user_id: z.string().uuid(),
  event_id: z.string().uuid().optional(),
  type: z.enum(['task_reminder', 'task_overdue', 'event_update', 'system']),
  title: z.string().min(1).max(200),
  body: z.string().min(1).max(2000),
  sent_via: z.enum(['in_app', 'email', 'both']).default('in_app'),
});
```

#### ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```typescript
const sendEmailSchema = z.object({
  to: z.string().email(),
  type: z.enum(['task_reminder', 'task_overdue', 'event_update']),
  context: z.object({
    userName: z.string(),
    taskName: z.string().optional(),
    eventName: z.string().optional(),
    dueDate: z.string().optional(),
    link: z.string().url(),
  }),
});
```

### [CONTRACT] ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- BR-VLD-001: é€šçŸ¥ä½œæˆæ™‚ã€`user_id` ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
- BR-VLD-002: `event_id` ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚¤ãƒ™ãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
- BR-VLD-003: ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ™‚ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæœ‰åŠ¹ã‹ç¢ºèª
- BR-VLD-004: é€šçŸ¥æ—¢èª­åŒ–æ™‚ã€`user_id` ãŒé€šçŸ¥ã®æ‰€æœ‰è€…ã‹ç¢ºèª

---

## Â§9 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### [CORE] ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | èª¬æ˜ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|--------------|----------------|------|--------------------|
| NOTIF_NOT_FOUND | 404 | é€šçŸ¥ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | é€šçŸ¥ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ |
| NOTIF_FORBIDDEN | 403 | ä»–äººã®é€šçŸ¥ã«ã‚¢ã‚¯ã‚»ã‚¹ | ã“ã®é€šçŸ¥ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ |
| NOTIF_MAIL_FAILED | 500 | ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•— | ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã»ã©å†è©¦è¡Œã•ã‚Œã¾ã™ |
| NOTIF_INVALID_TYPE | 400 | ä¸æ­£ãªé€šçŸ¥ã‚¿ã‚¤ãƒ— | é€šçŸ¥ã‚¿ã‚¤ãƒ—ãŒä¸æ­£ã§ã™ |

### [CONTRACT] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

#### ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—æ™‚
```
1. nodemailer ãŒã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
2. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’è¨˜éŒ²ï¼ˆSentryï¼‰
3. ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã«æŠ•å…¥ï¼ˆæœ€å¤§3å›ã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
4. 3å›å¤±æ•—ã—ãŸå ´åˆã€ç®¡ç†è€…ã«ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆSlack Webhook or ãƒ¡ãƒ¼ãƒ«ï¼‰
5. notification.email_sent_at ã‚’ NULL ã®ã¾ã¾ä¿æŒï¼ˆæœªé€ä¿¡æ‰±ã„ï¼‰
```

#### é€šçŸ¥æ—¢èª­åŒ–å¤±æ•—æ™‚
```
1. API ãŒ 404 or 403 ã‚’è¿”ã™
2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º: "é€šçŸ¥ã®æ—¢èª­åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ"
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å†è©¦è¡Œã‚’ä¿ƒã™
```

---

## Â§10 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### [CORE] èªè¨¼ãƒ»èªå¯
- ã™ã¹ã¦ã®é€šçŸ¥APIã¯ Better Auth èªè¨¼å¿…é ˆ
- é€šçŸ¥å–å¾—: è‡ªåˆ†å®›ã¦ã®é€šçŸ¥ã®ã¿å–å¾—å¯èƒ½ï¼ˆ`user_id = session.userId`ï¼‰
- é€šçŸ¥æ—¢èª­åŒ–: è‡ªåˆ†ã®é€šçŸ¥ã®ã¿æ—¢èª­åŒ–å¯èƒ½ï¼ˆ`user_id = session.userId`ï¼‰
- ä»–äººã®é€šçŸ¥ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã¯ 403 Forbidden

### [CONTRACT] ãƒ‡ãƒ¼ã‚¿ä¿è­·
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ï¼ˆ`.env`ï¼‰ã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„
- SMTPèªè¨¼æƒ…å ±ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰ã¯æš—å·åŒ–ã—ã¦ä¿å­˜ï¼ˆAWS Secrets Manager or 1Passwordï¼‰
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ­ã‚°ã«ã¯å€‹äººæƒ…å ±ã‚’å«ã‚ãªã„ï¼ˆuser_id ã¨é€ä¿¡çµæœã®ã¿è¨˜éŒ²ï¼‰

### [DETAIL] ã‚¹ãƒ‘ãƒ å¯¾ç­–
- åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€šçŸ¥é€ä¿¡ã¯ 1åˆ†é–“ã«æœ€å¤§ 10ä»¶ã¾ã§
- Rate Limiting: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š 100 req/minï¼ˆé€šçŸ¥APIï¼‰
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯ 1æ™‚é–“ã‚ãŸã‚Šæœ€å¤§ 100é€šã¾ã§ï¼ˆç•°å¸¸æ¤œçŸ¥ï¼‰

---

## Â§11 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### [CORE] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
- é€šçŸ¥ä¸€è¦§å–å¾—: 200ms ä»¥å†…ï¼ˆP95ï¼‰
- æœªèª­ä»¶æ•°å–å¾—: 100ms ä»¥å†…ï¼ˆP95ï¼‰
- é€šçŸ¥æ—¢èª­åŒ–: 150ms ä»¥å†…ï¼ˆP95ï¼‰
- ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º: å³åº§ï¼ˆ50ms ä»¥å†…ï¼‰
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚­ãƒ¥ãƒ¼æŠ•å…¥: 100ms ä»¥å†…

### [CONTRACT] æœ€é©åŒ–æˆ¦ç•¥

#### DB ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
```sql
-- æœªèª­é€šçŸ¥ã®é«˜é€Ÿå–å¾—
CREATE INDEX idx_notification_user_unread ON notification(user_id, is_read) WHERE is_read = FALSE;

-- ä½œæˆæ—¥æ™‚ã®é™é †ã‚½ãƒ¼ãƒˆ
CREATE INDEX idx_notification_created ON notification(created_at DESC);

-- ã‚¤ãƒ™ãƒ³ãƒˆIDã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿
CREATE INDEX idx_notification_event ON notification(event_id);
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- æœªèª­ä»¶æ•°: Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆTTL: 30ç§’ï¼‰
- é€šçŸ¥ä¸€è¦§: ãƒšãƒ¼ã‚¸ã”ã¨ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆTTL: 60ç§’ï¼‰
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–: é€šçŸ¥ä½œæˆæ™‚ãƒ»æ—¢èª­åŒ–æ™‚ã«è©²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢

#### éåŒæœŸå‡¦ç†
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯éåŒæœŸã‚­ãƒ¥ãƒ¼ï¼ˆBullmqï¼‰ã§å‡¦ç†ã€APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„
- ãƒãƒƒãƒå‡¦ç†ï¼ˆãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ»ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆï¼‰ã¯ Cron ã‚¸ãƒ§ãƒ–ã§å®Ÿè¡Œ

---

## Â§12 ãƒ†ã‚¹ãƒˆä»•æ§˜

### [CORE] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

#### 12.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆVitestï¼‰

**useNotification composable**
- `fetchNotifications()`: é€šçŸ¥ä¸€è¦§å–å¾—ã€limit/offset ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- `markAsRead(id)`: é€šçŸ¥æ—¢èª­åŒ–ã€APIå‘¼ã³å‡ºã—ç¢ºèª
- `markAllAsRead()`: å…¨æ—¢èª­åŒ–ã€updated_count ç¢ºèª
- `fetchUnreadCount()`: æœªèª­ä»¶æ•°å–å¾—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª

**ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆserver/utils/mail.tsï¼‰**
- `sendEmail(to, type, context)`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã®ç½®æ›ç¢ºèª
- `sendEmail()` ã‚¨ãƒ©ãƒ¼æ™‚: ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼æŠ•å…¥ç¢ºèª
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª

#### 12.2 çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆVitest + Supertestï¼‰

**GET /api/v1/notifications**
```typescript
describe('GET /api/v1/notifications', () => {
  it('è‡ªåˆ†å®›ã¦ã®é€šçŸ¥ã®ã¿å–å¾—ã§ãã‚‹', async () => {
    // 2ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†ã®é€šçŸ¥ã‚’ä½œæˆ
    const user1Token = await loginAsUser1();
    const user2Token = await loginAsUser2();

    await createNotification({ user_id: user1.id, title: 'User1 é€šçŸ¥' });
    await createNotification({ user_id: user2.id, title: 'User2 é€šçŸ¥' });

    const res = await request(app)
      .get('/api/v1/notifications')
      .set('Authorization', `Bearer ${user1Token}`)
      .expect(200);

    expect(res.body.notifications).toHaveLength(1);
    expect(res.body.notifications[0].title).toBe('User1 é€šçŸ¥');
  });

  it('æœªèª­ãƒ•ã‚£ãƒ«ã‚¿ãŒæ©Ÿèƒ½ã™ã‚‹', async () => {
    const token = await loginAsUser1();

    await createNotification({ user_id: user1.id, is_read: false });
    await createNotification({ user_id: user1.id, is_read: true });

    const res = await request(app)
      .get('/api/v1/notifications?is_read=false')
      .set('Authorization', `Bearer ${token}`)
      .expect(200);

    expect(res.body.notifications).toHaveLength(1);
    expect(res.body.notifications[0].is_read).toBe(false);
  });
});
```

**PATCH /api/v1/notifications/:id/read**
```typescript
describe('PATCH /api/v1/notifications/:id/read', () => {
  it('è‡ªåˆ†ã®é€šçŸ¥ã‚’æ—¢èª­åŒ–ã§ãã‚‹', async () => {
    const token = await loginAsUser1();
    const notification = await createNotification({ user_id: user1.id, is_read: false });

    const res = await request(app)
      .patch(`/api/v1/notifications/${notification.id}/read`)
      .set('Authorization', `Bearer ${token}`)
      .expect(200);

    expect(res.body.is_read).toBe(true);
    expect(res.body.read_at).toBeDefined();
  });

  it('ä»–äººã®é€šçŸ¥ã¯æ—¢èª­åŒ–ã§ããªã„ï¼ˆ403ï¼‰', async () => {
    const user1Token = await loginAsUser1();
    const user2Notification = await createNotification({ user_id: user2.id });

    await request(app)
      .patch(`/api/v1/notifications/${user2Notification.id}/read`)
      .set('Authorization', `Bearer ${user1Token}`)
      .expect(403);
  });
});
```

**POST /api/v1/notifications/read-all**
```typescript
describe('POST /api/v1/notifications/read-all', () => {
  it('æœªèª­é€šçŸ¥ã‚’ã™ã¹ã¦æ—¢èª­åŒ–ã§ãã‚‹', async () => {
    const token = await loginAsUser1();

    await createNotification({ user_id: user1.id, is_read: false });
    await createNotification({ user_id: user1.id, is_read: false });
    await createNotification({ user_id: user1.id, is_read: true }); // æ—¢èª­

    const res = await request(app)
      .post('/api/v1/notifications/read-all')
      .set('Authorization', `Bearer ${token}`)
      .expect(200);

    expect(res.body.updated_count).toBe(2);

    // ç¢ºèª: ã™ã¹ã¦æ—¢èª­ã«ãªã£ã¦ã„ã‚‹ã‹
    const notifications = await getNotifications(user1.id);
    expect(notifications.every(n => n.is_read)).toBe(true);
  });
});
```

**GET /api/v1/notifications/unread-count**
```typescript
describe('GET /api/v1/notifications/unread-count', () => {
  it('æœªèª­ä»¶æ•°ã‚’æ­£ã—ãå–å¾—ã§ãã‚‹', async () => {
    const token = await loginAsUser1();

    await createNotification({ user_id: user1.id, is_read: false });
    await createNotification({ user_id: user1.id, is_read: false });
    await createNotification({ user_id: user1.id, is_read: true });

    const res = await request(app)
      .get('/api/v1/notifications/unread-count')
      .set('Authorization', `Bearer ${token}`)
      .expect(200);

    expect(res.body.unread_count).toBe(2);
  });
});
```

#### 12.3 E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰

**é€šçŸ¥ãƒ‘ãƒãƒ«ã®é–‹é–‰**
```typescript
test('é€šçŸ¥ãƒ™ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨é€šçŸ¥ãƒ‘ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
  await loginAsUser(page, 'user1@example.com');

  // é€šçŸ¥ã‚’2ä»¶ä½œæˆ
  await createNotification({ user_id: user1.id, title: 'é€šçŸ¥1' });
  await createNotification({ user_id: user1.id, title: 'é€šçŸ¥2' });

  await page.goto('/dashboard');

  // é€šçŸ¥ãƒ™ãƒ«ã‚¯ãƒªãƒƒã‚¯
  await page.click('[data-testid="notification-bell"]');

  // é€šçŸ¥ãƒ‘ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
  await expect(page.locator('[data-testid="notification-panel"]')).toBeVisible();

  // é€šçŸ¥ãŒ2ä»¶è¡¨ç¤ºã•ã‚Œã‚‹
  const items = page.locator('[data-testid="notification-item"]');
  await expect(items).toHaveCount(2);
});
```

**é€šçŸ¥ã®æ—¢èª­åŒ–**
```typescript
test('é€šçŸ¥ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ—¢èª­åŒ–ã•ã‚Œã€ãƒãƒƒã‚¸ãŒæ¸›ã‚‹', async ({ page }) => {
  await loginAsUser(page, 'user1@example.com');

  // æœªèª­é€šçŸ¥ã‚’3ä»¶ä½œæˆ
  await createNotification({ user_id: user1.id, is_read: false });
  await createNotification({ user_id: user1.id, is_read: false });
  await createNotification({ user_id: user1.id, is_read: false });

  await page.goto('/dashboard');

  // ãƒãƒƒã‚¸ã«ã€Œ3ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹
  await expect(page.locator('[data-testid="notification-badge"]')).toHaveText('3');

  // é€šçŸ¥ãƒ‘ãƒãƒ«ã‚’é–‹ã
  await page.click('[data-testid="notification-bell"]');

  // 1ä»¶ç›®ã‚’ã‚¯ãƒªãƒƒã‚¯
  await page.click('[data-testid="notification-item"]:first-child');

  // ãƒãƒƒã‚¸ãŒã€Œ2ã€ã«æ¸›ã‚‹
  await expect(page.locator('[data-testid="notification-badge"]')).toHaveText('2');
});
```

**ã™ã¹ã¦æ—¢èª­**
```typescript
test('ã€Œã™ã¹ã¦æ—¢èª­ã€ãƒœã‚¿ãƒ³ã§æœªèª­é€šçŸ¥ãŒå…¨éƒ¨æ—¢èª­ã«ãªã‚‹', async ({ page }) => {
  await loginAsUser(page, 'user1@example.com');

  await createNotification({ user_id: user1.id, is_read: false });
  await createNotification({ user_id: user1.id, is_read: false });

  await page.goto('/dashboard');
  await page.click('[data-testid="notification-bell"]');

  // ã€Œã™ã¹ã¦æ—¢èª­ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  await page.click('[data-testid="mark-all-read-button"]');

  // ãƒãƒƒã‚¸ãŒæ¶ˆãˆã‚‹
  await expect(page.locator('[data-testid="notification-badge"]')).not.toBeVisible();

  // æœªèª­ãƒãƒ¼ã‚¯(â—)ãŒæ¶ˆãˆã‚‹
  await expect(page.locator('[data-testid="unread-indicator"]')).toHaveCount(0);
});
```

**ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º**
```typescript
test('ã‚¤ãƒ™ãƒ³ãƒˆä¿å­˜æˆåŠŸæ™‚ã«ãƒˆãƒ¼ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
  await loginAsUser(page, 'organizer@example.com');
  await page.goto('/events/new');

  await page.fill('[name="title"]', 'ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ');
  await page.fill('[name="start_at"]', '2026-03-01T10:00');
  await page.click('[data-testid="save-button"]');

  // ãƒˆãƒ¼ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
  await expect(page.locator('.toast')).toContainText('ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');

  // 3ç§’å¾Œã«è‡ªå‹•æ¶ˆå»ï¼ˆsuccess toastï¼‰
  await page.waitForTimeout(3500);
  await expect(page.locator('.toast')).not.toBeVisible();
});
```

#### 12.4 ãƒãƒƒãƒå‡¦ç†ãƒ†ã‚¹ãƒˆ

**ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ**
```typescript
describe('ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ', () => {
  it('æœŸæ—¥1æ—¥å‰ã®ã‚¿ã‚¹ã‚¯æ‹…å½“è€…ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã•ã‚Œã‚‹', async () => {
    // æ˜æ—¥ãŒæœŸæ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);

    const task = await createTask({
      title: 'ä¼šå ´äºˆç´„',
      due_date: tomorrow,
      assignee_id: user1.id,
      status: 'pending',
      reminder_sent: false,
    });

    // ãƒãƒƒãƒå®Ÿè¡Œ
    await runTaskReminderBatch();

    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ç¢ºèª
    const mailLog = await getMailLog({ user_id: user1.id, type: 'task_reminder' });
    expect(mailLog).toBeDefined();
    expect(mailLog.to).toBe(user1.email);

    // notification ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    const notification = await getNotification({ user_id: user1.id, type: 'task_reminder' });
    expect(notification).toBeDefined();
    expect(notification.title).toContain('ä¼šå ´äºˆç´„');

    // reminder_sent ãƒ•ãƒ©ã‚°ãŒ true ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
    const updatedTask = await getTask(task.id);
    expect(updatedTask.reminder_sent).toBe(true);
  });

  it('ã™ã§ã«å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã«ã¯ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’é€ä¿¡ã—ãªã„', async () => {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);

    await createTask({
      due_date: tomorrow,
      assignee_id: user1.id,
      status: 'completed', // å®Œäº†æ¸ˆã¿
      reminder_sent: false,
    });

    await runTaskReminderBatch();

    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
    const mailLog = await getMailLog({ user_id: user1.id, type: 'task_reminder' });
    expect(mailLog).toBeUndefined();
  });
});
```

**ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒƒãƒ**
```typescript
describe('ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒƒãƒ', () => {
  it('æœŸæ—¥è¶…éã®ã‚¿ã‚¹ã‚¯æ‹…å½“è€…ã«ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ã•ã‚Œã‚‹', async () => {
    // æ˜¨æ—¥ãŒæœŸæ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);

    const task = await createTask({
      title: 'æ©Ÿææ‰‹é…',
      due_date: yesterday,
      assignee_id: user1.id,
      status: 'pending',
      overdue_alert_sent: false,
    });

    await runTaskOverdueBatch();

    // ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’ç¢ºèª
    const mailLog = await getMailLog({ user_id: user1.id, type: 'task_overdue' });
    expect(mailLog).toBeDefined();
    expect(mailLog.to).toBe(user1.email);

    // notification ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
    const notification = await getNotification({ user_id: user1.id, type: 'task_overdue' });
    expect(notification.title).toContain('âš ï¸');
    expect(notification.title).toContain('æ©Ÿææ‰‹é…');
  });
});
```

### [CONTRACT] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: 80%+
- çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆAPIï¼‰: 70%+
- E2Eãƒ†ã‚¹ãƒˆ: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ï¼ˆé€šçŸ¥ãƒ‘ãƒãƒ«ãƒ»ãƒˆãƒ¼ã‚¹ãƒˆï¼‰100%
- ãƒãƒƒãƒå‡¦ç†: 80%+

---

## Â§13 å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### [CORE] å®Ÿè£…ã®å„ªå…ˆé †ä½

#### Phase 1: ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ï¼ˆãƒˆãƒ¼ã‚¹ãƒˆï¼‰
1. `useAppToast()` composable å®Ÿè£…ï¼ˆNuxt UI v3 useToast ãƒ©ãƒƒãƒ‘ãƒ¼ï¼‰
2. ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆsuccess / error / warning / infoï¼‰
3. æ—¢å­˜ã® API å‘¼ã³å‡ºã—ã«ãƒˆãƒ¼ã‚¹ãƒˆè¿½åŠ ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆä¿å­˜ãƒ»å‰Šé™¤ãªã©ï¼‰

#### Phase 2: é€šçŸ¥ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»API
1. `notification` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
2. é€šçŸ¥APIå®Ÿè£…ï¼ˆGET /api/v1/notifications ãªã©ï¼‰
3. é€šçŸ¥ä½œæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆ`createNotification()`ï¼‰

#### Phase 3: é€šçŸ¥ãƒ™ãƒ«ãƒ»ãƒ‘ãƒãƒ«
1. `NotificationBell.vue` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
2. `NotificationPanel.vue` å®Ÿè£…ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
3. `useNotification()` composable å®Ÿè£…
4. ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«é€šçŸ¥ãƒ™ãƒ«é…ç½®

#### Phase 4: ãƒ¡ãƒ¼ãƒ«é€ä¿¡
1. nodemailer ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆSMTPè¨­å®šï¼‰
2. ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆEJS or Handlebarsï¼‰
3. ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆ`server/utils/mail.ts`ï¼‰
4. éåŒæœŸã‚­ãƒ¥ãƒ¼ï¼ˆBullmqï¼‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### Phase 5: ãƒãƒƒãƒå‡¦ç†
1. ã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒï¼ˆCron ã‚¸ãƒ§ãƒ–ï¼‰
2. ç· ã‚åˆ‡ã‚Šã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒƒãƒ
3. ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°é€šçŸ¥ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰

### [DETAIL] å®Ÿè£…ä¾‹

#### 1. useAppToast composable

```typescript
// composables/useAppToast.ts
export const useAppToast = () => {
  const toast = useToast();

  const showSuccess = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'green',
      icon: 'i-heroicons-check-circle',
      timeout: 3000,
    });
  };

  const showError = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'red',
      icon: 'i-heroicons-exclamation-circle',
      timeout: 0, // æ‰‹å‹•æ¶ˆå»
    });
  };

  const showWarning = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'yellow',
      icon: 'i-heroicons-exclamation-triangle',
      timeout: 7000,
    });
  };

  const showInfo = (title: string, description?: string) => {
    toast.add({
      title,
      description,
      color: 'blue',
      icon: 'i-heroicons-information-circle',
      timeout: 5000,
    });
  };

  return { showSuccess, showError, showWarning, showInfo };
};
```

#### 2. useNotification composable

```typescript
// composables/useNotification.ts
export const useNotification = () => {
  const notifications = ref<Notification[]>([]);
  const unreadCount = ref(0);
  const loading = ref(false);

  const fetchNotifications = async (params?: { limit?: number; offset?: number; is_read?: boolean }) => {
    loading.value = true;
    try {
      const data = await $fetch('/api/v1/notifications', { params });
      notifications.value = data.notifications;
      return data;
    } catch (error) {
      console.error('Failed to fetch notifications:', error);
      throw error;
    } finally {
      loading.value = false;
    }
  };

  const fetchUnreadCount = async () => {
    try {
      const data = await $fetch('/api/v1/notifications/unread-count');
      unreadCount.value = data.unread_count;
      return data.unread_count;
    } catch (error) {
      console.error('Failed to fetch unread count:', error);
      throw error;
    }
  };

  const markAsRead = async (id: string) => {
    try {
      await $fetch(`/api/v1/notifications/${id}/read`, { method: 'PATCH' });
      // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹æ›´æ–°
      const notification = notifications.value.find(n => n.id === id);
      if (notification) {
        notification.is_read = true;
        notification.read_at = new Date().toISOString();
      }
      unreadCount.value = Math.max(0, unreadCount.value - 1);
    } catch (error) {
      console.error('Failed to mark as read:', error);
      throw error;
    }
  };

  const markAllAsRead = async () => {
    try {
      const data = await $fetch('/api/v1/notifications/read-all', { method: 'POST' });
      // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹æ›´æ–°
      notifications.value.forEach(n => {
        n.is_read = true;
        n.read_at = new Date().toISOString();
      });
      unreadCount.value = 0;
      return data.updated_count;
    } catch (error) {
      console.error('Failed to mark all as read:', error);
      throw error;
    }
  };

  // å®šæœŸãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆ5ç§’ã”ã¨ï¼‰
  const startPolling = () => {
    const interval = setInterval(() => {
      fetchUnreadCount();
    }, 5000);

    onUnmounted(() => clearInterval(interval));
  };

  return {
    notifications,
    unreadCount,
    loading,
    fetchNotifications,
    fetchUnreadCount,
    markAsRead,
    markAllAsRead,
    startPolling,
  };
};
```

#### 3. NotificationBell.vue

```vue
<!-- components/features/notification/NotificationBell.vue -->
<template>
  <div class="relative">
    <UButton
      icon="i-heroicons-bell"
      color="gray"
      variant="ghost"
      @click="togglePanel"
      data-testid="notification-bell"
    >
      <UBadge
        v-if="unreadCount > 0"
        color="red"
        variant="solid"
        class="absolute -top-1 -right-1"
        data-testid="notification-badge"
      >
        {{ unreadCount > 99 ? '99+' : unreadCount }}
      </UBadge>
    </UButton>

    <NotificationPanel
      v-if="isOpen"
      @close="isOpen = false"
    />
  </div>
</template>

<script setup lang="ts">
const { unreadCount, fetchUnreadCount, startPolling } = useNotification();
const isOpen = ref(false);

const togglePanel = () => {
  isOpen.value = !isOpen.value;
};

onMounted(() => {
  fetchUnreadCount();
  startPolling();
});
</script>
```

#### 4. NotificationPanel.vue

```vue
<!-- components/features/notification/NotificationPanel.vue -->
<template>
  <UCard
    class="absolute right-0 top-12 w-96 max-h-96 overflow-y-auto shadow-lg z-50"
    data-testid="notification-panel"
  >
    <template #header>
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">é€šçŸ¥</h3>
        <UButton
          size="xs"
          variant="ghost"
          @click="handleMarkAllAsRead"
          data-testid="mark-all-read-button"
        >
          ã™ã¹ã¦æ—¢èª­
        </UButton>
      </div>
    </template>

    <div v-if="loading" class="text-center py-4">
      <UIcon name="i-heroicons-arrow-path" class="animate-spin" />
    </div>

    <div v-else-if="notifications.length === 0" class="text-center py-4 text-gray-500">
      é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“
    </div>

    <div v-else>
      <NotificationItem
        v-for="notification in notifications"
        :key="notification.id"
        :notification="notification"
        @click="handleNotificationClick(notification)"
      />
    </div>

    <template #footer>
      <UButton
        variant="ghost"
        block
        @click="$router.push('/notifications')"
      >
        ã™ã¹ã¦è¦‹ã‚‹
      </UButton>
    </template>
  </UCard>
</template>

<script setup lang="ts">
const { notifications, loading, fetchNotifications, markAsRead, markAllAsRead } = useNotification();
const { showSuccess, showError } = useAppToast();
const router = useRouter();

const emit = defineEmits<{
  close: []
}>();

onMounted(() => {
  fetchNotifications({ limit: 10 });
});

const handleNotificationClick = async (notification: Notification) => {
  try {
    if (!notification.is_read) {
      await markAsRead(notification.id);
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã¸é·ç§»
    if (notification.event_id) {
      router.push(`/events/${notification.event_id}`);
    }

    emit('close');
  } catch (error) {
    showError('é€šçŸ¥ã®æ—¢èª­åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};

const handleMarkAllAsRead = async () => {
  try {
    const count = await markAllAsRead();
    showSuccess(`${count}ä»¶ã®é€šçŸ¥ã‚’æ—¢èª­ã«ã—ã¾ã—ãŸ`);
  } catch (error) {
    showError('ä¸€æ‹¬æ—¢èª­åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};
</script>
```

#### 5. ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```typescript
// server/utils/mail.ts
import nodemailer from 'nodemailer';
import { readFileSync } from 'fs';
import { compile } from 'handlebars';

const transporter = nodemailer.createTransport({
  host: process.env.SMTP_HOST,
  port: Number(process.env.SMTP_PORT),
  secure: true,
  auth: {
    user: process.env.SMTP_USER,
    pass: process.env.SMTP_PASS,
  },
});

const MAIL_TEMPLATES = {
  task_reminder: {
    subject: '[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] ã‚¿ã‚¹ã‚¯æœŸæ—¥ã®ãƒªãƒã‚¤ãƒ³ãƒ‰: {{taskName}}',
    template: 'task-reminder.html',
  },
  task_overdue: {
    subject: '[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] âš ï¸ ã‚¿ã‚¹ã‚¯æœŸæ—¥è¶…é: {{taskName}}',
    template: 'task-overdue.html',
  },
  event_update: {
    subject: '[é…ä¿¡ãƒ—ãƒ©ã‚¹Hub] ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ: {{eventName}}',
    template: 'event-update.html',
  },
};

export const sendEmail = async (
  to: string,
  type: keyof typeof MAIL_TEMPLATES,
  context: Record<string, string>
) => {
  try {
    const templateConfig = MAIL_TEMPLATES[type];

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆèª­ã¿è¾¼ã¿
    const templatePath = `server/templates/email/${templateConfig.template}`;
    const templateSource = readFileSync(templatePath, 'utf-8');
    const template = compile(templateSource);

    // ä»¶åãƒ»æœ¬æ–‡ç”Ÿæˆ
    const subject = compile(templateConfig.subject)(context);
    const html = template(context);

    // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    await transporter.sendMail({
      from: process.env.SMTP_FROM,
      to,
      subject,
      html,
    });

    console.log(`Email sent: ${type} to ${to}`);
  } catch (error) {
    console.error('Failed to send email:', error);
    throw error;
  }
};
```

#### 6. é€šçŸ¥ä½œæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```typescript
// server/utils/notification.ts
import { db } from '~/server/utils/db';
import { notification } from '~/server/database/schema';

export const createNotification = async (data: {
  tenant_id: string;
  user_id: string;
  event_id?: string;
  type: string;
  title: string;
  body: string;
  sent_via?: 'in_app' | 'email' | 'both';
}) => {
  const [newNotification] = await db.insert(notification).values(data).returning();

  // ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãŒå¿…è¦ãªå ´åˆ
  if (data.sent_via === 'email' || data.sent_via === 'both') {
    // éåŒæœŸã‚­ãƒ¥ãƒ¼ã«æŠ•å…¥ï¼ˆå®Ÿè£…ä¾‹: Bullmqï¼‰
    await notificationQueue.add('send-email', {
      notification_id: newNotification.id,
      user_id: data.user_id,
      type: data.type,
    });
  }

  return newNotification;
};
```

---

## Â§14 é‹ç”¨

### [CORE] ç›£è¦–é …ç›®
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸç‡ï¼ˆç›®æ¨™: 99%+ï¼‰
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡é…å»¶ï¼ˆP95 < 5åˆ†ï¼‰
- é€šçŸ¥API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ï¼ˆP95 < 200msï¼‰
- æœªèª­é€šçŸ¥æ»ç•™ä»¶æ•°ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šå¹³å‡ < 10ä»¶ï¼‰
- ãƒãƒƒãƒå‡¦ç†å®Ÿè¡Œæ™‚é–“ï¼ˆã‚¿ã‚¹ã‚¯ãƒªãƒã‚¤ãƒ³ãƒ‰: < 5åˆ†ï¼‰

### [CONTRACT] ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—ç‡ãŒ 5% ã‚’è¶…ãˆãŸã‚‰ Slack é€šçŸ¥
- é€šçŸ¥API ã®ã‚¨ãƒ©ãƒ¼ç‡ãŒ 1% ã‚’è¶…ãˆãŸã‚‰ PagerDuty ã‚¢ãƒ©ãƒ¼ãƒˆ
- ãƒãƒƒãƒå‡¦ç†ãŒå¤±æ•—ã—ãŸã‚‰ç®¡ç†è€…ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

### [DETAIL] ãƒ­ã‚°å‡ºåŠ›
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ­ã‚°: `{ user_id, type, to, status, error }`
- é€šçŸ¥ä½œæˆãƒ­ã‚°: `{ notification_id, user_id, type, sent_via }`
- ãƒãƒƒãƒå‡¦ç†ãƒ­ã‚°: `{ batch_type, processed_count, failed_count, duration }`

---

## Â§15 æœªæ±ºå®šäº‹é …ãƒ»åˆ¶ç´„ [CONTRACT]

### å‰ææ¡ä»¶
- Better Auth ã‚»ãƒƒã‚·ãƒ§ãƒ³èªè¨¼æ¸ˆã¿
- PostgreSQL notification ãƒ†ãƒ¼ãƒ–ãƒ« (SSOT-4 Â§2.10)
- nodemailer ã«ã‚ˆã‚‹ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- Nuxt UI v3 useToast

### åˆ¶ç´„
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯éåŒæœŸã‚­ãƒ¥ãƒ¼å‡¦ç†ï¼ˆAPIå¿œç­”ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ï¼‰
- ãƒªãƒˆãƒ©ã‚¤ã¯æœ€å¤§3å›ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•: 1åˆ†å¾Œã€5åˆ†å¾Œã€15åˆ†å¾Œï¼‰
- é€šçŸ¥ä¿æŒæœŸé–“: 90æ—¥ï¼ˆè¶…éåˆ†ã¯å‰Šé™¤ãƒãƒƒãƒã§æ¯æ—¥ 02:00 ã«å‰Šé™¤ï¼‰
- åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€šçŸ¥é€ä¿¡ä¸Šé™: 1åˆ†é–“ã«æœ€å¤§10ä»¶
- é€šçŸ¥API Rate Limiting: 100 req/minï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šï¼‰

### æœªæ±ºå®šäº‹é …

| é …ç›®ID | é …ç›® | é¸æŠè‚¢ | æœŸé™ | æ±ºå®šè€… |
|--------|------|--------|------|--------|
| NOTIF-TBD-01 | é€šçŸ¥ã‚­ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  | (1) Bullmq+Redis (2) pg-boss (3) ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ | MVPå‰ | Tech Lead |
| NOTIF-TBD-02 | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥æ–¹å¼ | (1) ãƒãƒ¼ãƒªãƒ³ã‚°5ç§’ (2) WebSocket (3) SSE | MVPå‰ | Tech Lead |
| NOTIF-TBD-03 | ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ | (1) SendGrid (2) Amazon SES (3) Resend | MVPå‰ | Tech Lead |

---

## Â§16 å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´è€… | å¤‰æ›´å†…å®¹ |
|------|--------|----------|
| 2026-02-09 | Claude | åˆç‰ˆä½œæˆï¼ˆNOTIF-001 + NOTIF-002 çµ±åˆä»•æ§˜ï¼‰ |
| 2026-02-09 | Claude | v1.1: Â§3-E/F/G/Hï¼ˆå…¥å‡ºåŠ›ä¾‹ãƒ»å¢ƒç•Œå€¤ãƒ»ä¾‹å¤–ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ»å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆï¼‰è¿½åŠ ã€Â§15 æœªæ±ºå®šäº‹é …ãƒ»åˆ¶ç´„ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ  |

---

**END OF SPECIFICATION**
